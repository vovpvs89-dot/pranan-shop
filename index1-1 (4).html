<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>PRANAN SHOP</title>
<style>
*{box-sizing:border-box;font-family:'Segoe UI',sans-serif}
body{margin:0;background:#f8f9fa;}

/* HEADER */
header{background:#d50000;color:#fff;padding:15px 30px;display:flex;align-items:center;gap:20px;position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,0.04)}
.logo{font-size:22px;font-weight:bold}
.search{flex:1}
.search input{width:100%;padding:10px 15px;border-radius:30px;border:none}
nav{display:flex;align-items:center;gap:5px}
nav a{color:#fff;text-decoration:none;margin:0 10px;font-weight:500;transition:all 0.3s;cursor:pointer}
nav a:hover{background:rgba(255,255,255,0.2);border-radius:8px;padding:8px 12px;margin:0}
.dropdown{position:relative;display:inline-block}
.dropdown-toggle{color:#fff;text-decoration:none;margin:0 10px;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:5px;transition:all 0.3s;padding:8px 12px;border-radius:8px}
.dropdown-toggle:hover{background:rgba(255,255,255,0.2)}
.dropdown-toggle::after{content:'‚ñº';font-size:10px;transition:transform 0.3s}
.dropdown.active .dropdown-toggle{background:rgba(255,255,255,0.2)}
.dropdown.active .dropdown-toggle::after{transform:rotate(180deg)}
.dropdown-menu{display:none;position:absolute;top:100%;left:0;background:#fff;min-width:220px;box-shadow:0 10px 40px rgba(0,0,0,0.06);border-radius:12px;margin-top:8px;z-index:1000;overflow:hidden;animation:slideDown 0.3s ease}
.dropdown.active .dropdown-menu{display:block}
.dropdown-menu a{display:block;padding:12px 20px;color:#333;text-decoration:none;font-weight:500;border-bottom:1px solid #f0f0f0;transition:all 0.3s;margin:0}
.dropdown-menu a:last-child{border-bottom:none}
.dropdown-menu a:hover{background:#d50000;color:#fff;padding-left:25px}
.dropdown-menu a::before{content:'‚ñ∏';margin-right:8px;opacity:0;transition:opacity 0.3s}
.dropdown-menu a:hover::before{opacity:1}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

/* FLOATING CONTACT BUTTON */
.floating-contact{position:fixed;bottom:25px;right:25px;background:linear-gradient(135deg,#b71c1c,#d50000);color:#fff;padding:12px 24px;border-radius:35px;box-shadow:0 8px 30px rgba(183,28,28,0.12);cursor:pointer;font-weight:bold;font-size:14px;z-index:1000;transition:all 0.3s ease;border:none;letter-spacing:0.5px;display:flex;align-items:center;gap:8px;backdrop-filter:blur(10px);}
.floating-contact::before{content:'‚úâ';font-size:16px;filter:drop-shadow(0 0 3px rgba(255,255,255,0.8));}
.floating-contact:hover{transform:translateY(-5px) scale(1.05);box-shadow:0 15px 50px rgba(183,28,28,0.2);background:linear-gradient(135deg,#8b0000,#b71c1c);}
.floating-contact:active{transform:translateY(-2px) scale(1.02);}
@keyframes float{0%,100%{transform:translateY(0px)}50%{transform:translateY(-8px)}}
.floating-contact{animation:float 3s ease-in-out infinite;}

/* ADMIN QUICK BUTTONS */
button[onclick*="switchPage"]:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 35px rgba(0,0,0,0.15) !important;
}

/* SNOWFLAKE EFFECT - REMOVED FOR USABILITY */
/* .snowflake{position:fixed;top:-10px;color:#fff;font-size:1em;font-family:Arial,sans-serif;text-shadow:0 0 5px #000;z-index:9999;pointer-events:none;animation:fall linear infinite;}
@keyframes fall{0%{top:-10%;opacity:1;}100%{top:110%;opacity:0.3;}} */

.cart{position:relative;font-size:20px}
.cart span{position:absolute;top:-8px;right:-10px;background:#fff;color:#d50000;border-radius:50%;padding:2px 6px;font-size:12px}
.login-btn{background:#fff;color:#d50000;border:none;padding:8px 20px;border-radius:20px;cursor:pointer;font-weight:600;margin-left:10px;transition:all 0.3s ease}
.login-btn:hover{background:#f5f5f5;transform:translateY(-2px)}
.admin-btn{background:#d50000;color:#fff;border:none;padding:8px 20px;border-radius:20px;cursor:pointer;font-weight:600;margin-left:5px;box-shadow:0 4px 20px rgba(0,0,0,0.3), 0 2px 8px rgba(213,0,0,0.5);transition:all 0.3s ease}
.admin-btn:hover{background:#b40000;transform:translateY(-3px) scale(1.05);box-shadow:0 8px 30px rgba(0,0,0,0.35), 0 4px 15px rgba(213,0,0,0.6)}
.admin-btn:active{transform:translateY(-1px) scale(1.02);box-shadow:0 3px 12px rgba(0,0,0,0.25), 0 1px 6px rgba(213,0,0,0.4)}

/* MAIN LAYOUT */
main{padding:30px; min-height: 80vh;}
.section-title{color:#d50000;font-size:32px;margin-bottom:25px;font-weight:800;text-align:left;text-transform:uppercase;letter-spacing:2px;position:relative;padding-bottom:15px;}
.section-title::after{content:'';position:absolute;bottom:0;left:0;width:100px;height:4px;background:linear-gradient(90deg,#d50000,#ff6b6b);border-radius:2px;}

/* PRODUCT GRID */
.products{display:grid;grid-template-columns:repeat(5, 1fr);gap:20px}
.card{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.03);border:1px solid #f5f5f5;padding:15px;display:flex;flex-direction:column;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);position:relative;}
.card:hover{transform:translateY(-8px);box-shadow:0 20px 60px rgba(213,0,0,0.08);border-color:#ffe5e5;}
.card .img-wrapper{position:relative;width:100%;margin-bottom:10px;}
.card img{width:100%;height:160px;object-fit:contain;border-radius:8px;display:block;}
.discount-badge{position:absolute;top:10px;right:10px;background:linear-gradient(135deg,#ff3838,#d50000);color:#fff;padding:8px 12px;border-radius:8px;font-weight:bold;font-size:14px;box-shadow:0 6px 20px rgba(213,0,0,0.15);z-index:10;}
.brand{color:#d50000;font-size:13px;font-weight:bold}
.name{font-weight:600;margin:5px 0}
.desc{font-size:13px;color:#555;flex:1}
.price{font-size:20px;font-weight:bold;margin:10px 0}
.card button{background:#d50000;color:#fff;border:none;padding:10px;border-radius:25px;cursor:pointer;transition:background 0.3s}
.card button:hover{background:#b40000}

/* PROMO */
.promo{background:#fff;border-radius:15px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,0.04)}
.promo img{width:100%;border-radius:12px;margin-bottom:15px}
.promo h3{color:#d50000;margin:0 0 10px}
.promo p{font-size:14px;color:#444}

/* CAROUSEL */
.carousel-container{position:relative;width:100%;overflow:hidden;border-radius:20px;box-shadow:0 10px 50px rgba(213,0,0,0.1);margin-bottom:40px;}
.carousel-wrapper{display:flex;transition:transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);}
.carousel-slide{min-width:100%;height:450px;position:relative;background:#fff;}
.carousel-slide img{width:100%;height:100%;object-fit:cover;object-position:center;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;filter:contrast(1.05) saturate(1.1) brightness(1.02);-webkit-backface-visibility:hidden;backface-visibility:hidden;transform:translateZ(0);}
.carousel-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.95);color:#d50000;border:none;width:55px;height:55px;border-radius:50%;cursor:pointer;font-size:28px;font-weight:bold;transition:all 0.3s;z-index:10;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 25px rgba(0,0,0,0.1);backdrop-filter:blur(10px);}
.carousel-btn:hover{background:#fff;transform:translateY(-50%) scale(1.15);box-shadow:0 12px 45px rgba(213,0,0,0.15);}
.carousel-btn:active{transform:translateY(-50%) scale(1.05);}
.carousel-btn-prev{left:25px;}
.carousel-btn-next{right:25px;}
.carousel-indicators{position:absolute;bottom:25px;left:50%;transform:translateX(-50%);display:flex;gap:12px;z-index:10;padding:10px 20px;background:rgba(255,255,255,0.9);border-radius:30px;backdrop-filter:blur(10px);box-shadow:0 4px 20px rgba(0,0,0,0.08);}
.carousel-indicator{width:12px;height:12px;border-radius:50%;background:rgba(213,0,0,0.3);border:2px solid rgba(213,0,0,0.5);cursor:pointer;transition:all 0.3s;}
.carousel-indicator.active{background:#d50000;border-color:#d50000;transform:scale(1.3);box-shadow:0 0 12px rgba(213,0,0,0.6);}

/* === NEW MANAGE PAGE STYLES === */
.manage-container {
    max-width: 1000px;
    margin: 0 auto;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 8px 50px rgba(0,0,0,0.04);
    padding: 50px;
    animation: fadeIn 0.5s ease;
}
.manage-header {
    text-align: center;
    margin-bottom: 40px;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 20px;
}
.manage-header h2 { color: #d50000; margin: 0; font-size: 32px; }
.manage-header p { color: #666; margin-top: 10px; font-size: 16px; }

.form-grid {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 40px;
}
.form-left { text-align: center; }
.form-right { display: flex; flex-direction: column; gap: 20px; }

.preview-box {
    width: 100%;
    height: 300px;
    background: #fafafa;
    border: 2px dashed #ddd;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
    overflow: hidden;
    margin-bottom: 15px;
}
.preview-box img { width: 100%; height: 100%; object-fit: contain; }
.preview-hint { font-size: 13px; color: #888; }

.input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

.form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
.form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 15px;
    transition: all 0.3s;
    background: #fff;
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    border-color: #d50000;
    box-shadow: 0 0 0 4px rgba(213,0,0,0.1);
    outline: none;
}

.action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 10px;
    justify-content: flex-end;
}
.btn-save {
    background: linear-gradient(135deg, #d50000 0%, #b40000 100%);
    color: #fff; border: none; padding: 12px 30px; border-radius: 30px;
    font-weight: 700; cursor: pointer; font-size: 16px;
    box-shadow: 0 4px 15px rgba(213,0,0,0.3); transition: transform 0.2s;
}
.btn-save:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(213,0,0,0.4); }
.btn-cancel {
    background: #f0f0f0; color: #333; border: none; padding: 12px 25px;
    border-radius: 30px; font-weight: 600; cursor: pointer; font-size: 16px;
    transition: background 0.3s;
}
.btn-cancel:hover { background: #e0e0e0; }

/* === STOCK PAGE STYLES === */
.stock-container {
    max-width: 1400px;
    margin: 0 auto;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.08);
    padding: 40px;
    animation: fadeIn 0.5s ease;
}
.stock-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f0f0f0;
}
.stock-header h2 {
    color: #d50000;
    margin: 0;
    font-size: 32px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.stock-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 30px;
}
.stat-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    border: 2px solid #f0f0f0;
    transition: all 0.3s;
}
.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    border-color: #d50000;
}
.stat-card .icon {
    font-size: 40px;
    margin-bottom: 10px;
}
.stat-card .number {
    font-size: 32px;
    font-weight: bold;
    color: #d50000;
    margin: 10px 0;
}
.stat-card .label {
    color: #666;
    font-size: 14px;
    font-weight: 600;
}
.stock-table-wrapper {
    overflow-x: auto;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}
.stock-table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
}
.stock-table thead {
    background: linear-gradient(135deg, #d50000 0%, #b40000 100%);
    color: #fff;
}
.stock-table th {
    padding: 15px;
    text-align: left;
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
.stock-table td {
    padding: 15px;
    border-bottom: 1px solid #f0f0f0;
    font-size: 14px;
}
.stock-table tbody tr {
    transition: background 0.3s;
}
.stock-table tbody tr:hover {
    background: #fef5f5;
}
.stock-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
}
.stock-high { background: #d4edda; color: #155724; }
.stock-medium { background: #fff3cd; color: #856404; }
.stock-low { background: #f8d7da; color: #721c24; }
.stock-out { background: #f5c6cb; color: #721c24; font-weight: bold; }

/* === CONTACT PAGE STYLES === */
.contact-container {
    max-width: 1200px;
    margin: 0 auto;
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.08);
    padding: 50px;
    animation: fadeIn 0.5s ease;
}
.contact-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f0f0f0;
}
.contact-header h2 {
    color: #d50000;
    margin: 0;
    font-size: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
.contact-header p {
    color: #666;
    margin-top: 10px;
    font-size: 16px;
}
.contact-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-bottom: 40px;
}
.contact-info {
    display: flex;
    flex-direction: column;
    gap: 25px;
}
.info-card {
    background: linear-gradient(135deg, #fef5f5 0%, #ffffff 100%);
    padding: 25px;
    border-radius: 15px;
    border-left: 4px solid #d50000;
    transition: all 0.3s;
}
.info-card:hover {
    transform: translateX(10px);
    box-shadow: 0 5px 20px rgba(213,0,0,0.15);
}
.info-card .icon {
    font-size: 32px;
    margin-bottom: 10px;
}
.info-card h3 {
    color: #d50000;
    margin: 10px 0;
    font-size: 18px;
}
.info-card p {
    color: #555;
    margin: 5px 0;
    line-height: 1.6;
}
.contact-form {
    background: #fafafa;
    padding: 30px;
    border-radius: 15px;
}
.contact-form h3 {
    color: #d50000;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 22px;
}
.form-group-contact {
    margin-bottom: 20px;
}
.form-group-contact label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}
.form-group-contact input,
.form-group-contact textarea {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 15px;
    transition: all 0.3s;
    background: #fff;
    font-family: 'Segoe UI', sans-serif;
}
.form-group-contact input:focus,
.form-group-contact textarea:focus {
    border-color: #d50000;
    box-shadow: 0 0 0 4px rgba(213,0,0,0.1);
    outline: none;
}
.form-group-contact textarea {
    resize: vertical;
    min-height: 120px;
}
.btn-send {
    background: linear-gradient(135deg, #d50000 0%, #b40000 100%);
    color: #fff;
    border: none;
    padding: 12px 40px;
    border-radius: 30px;
    font-weight: 700;
    cursor: pointer;
    font-size: 16px;
    width: 100%;
    box-shadow: 0 4px 15px rgba(213,0,0,0.3);
    transition: transform 0.2s;
}
.btn-send:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(213,0,0,0.4);
}
.contact-map {
    width: 100%;
    height: 350px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.contact-map iframe {
    width: 100%;
    height: 100%;
    border: none;
}

/* MODAL (For Login/Register only) */
/* PRODUCT DETAIL MODAL CSS */
.product-detail-container { display: flex; gap: 30px; margin-bottom: 30px; }
.product-detail-img { flex: 1; max-width: 50%; position: relative; }
.product-detail-img img { width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.product-detail-info { flex: 1; display: flex; flex-direction: column; gap: 10px; }
.product-detail-title { font-size: 22px; font-weight: bold; color: #333; margin: 0; line-height: 1.4; }
.product-detail-brand { font-size: 14px; color: #666; display: flex; gap: 10px; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
.product-detail-brand span { color: #999; }
.product-detail-buttons { display: flex; gap: 10px; margin-top: 5px; }
.share-btn { background: none; border: none; color: #999; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 14px; transition: color 0.3s; }
.share-btn:hover { color: #d50000; }
.product-detail-price { font-size: 32px; font-weight: bold; color: #d50000; display: flex; align-items: center; gap: 15px; margin: 15px 0; }
.product-detail-old-price { font-size: 18px; color: #999; text-decoration: line-through; font-weight: normal; }
.qty-selector { display: inline-flex; align-items: center; border: 1px solid #ddd; border-radius: 4px; overflow: hidden; height: 40px; margin-right: 15px; }
.qty-btn { width: 40px; height: 100%; background: #fff; border: none; cursor: pointer; font-size: 18px; color: #d50000; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
.qty-btn:hover { background: #f5f5f5; }
.qty-input { width: 50px; height: 100%; text-align: center; border: none; border-left: 1px solid #ddd; border-right: 1px solid #ddd; font-size: 16px; font-weight: 600; outline: none; }
.product-actions-row { display: flex; align-items: center; margin-top: 20px; margin-bottom: 20px; }
.btn-add-cart { background: #fff; color: #d50000; border: 1px solid #d50000; padding: 12px 25px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; flex: 1; justify-content: center; margin-right: 10px; }
.btn-add-cart:hover { background: #fff0f0; border-color: #b40000; color: #b40000; }
.btn-buy-now { background: #d50000; color: #fff; border: none; padding: 12px 25px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: all 0.3s; flex: 1.5; justify-content: center; }
.btn-buy-now:hover { background: #b40000; }
.product-tags { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 15px; }
.tag-badge { background: #d50000; color: #fff; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase; }

.spec-container { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
.spec-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; color: #333; }
.spec-header svg { width: 24px; height: 24px; color: #d50000; fill: currentColor; }
.spec-header h3 { margin: 0; font-size: 20px; }
.spec-table { width: 100%; border-collapse: collapse; border: 1px solid #eee; border-radius: 8px; overflow: hidden; }
.spec-table tr:first-child th, .spec-table tr:first-child td { border-top: none; }
.spec-table th, .spec-table td { padding: 15px 20px; border-bottom: 1px solid #eee; font-size: 14px; text-align: left; }
.spec-table th { width: 35%; color: #333; font-weight: 600; background: #fafafa; }
.spec-table td { color: #555; }
.spec-table tr:last-child th, .spec-table tr:last-child td { border-bottom: none; }

.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;}
.modal.show{display:flex;}
.modal-content{background:#fff;border-radius:8px;padding:30px;width:90%;max-width:400px;position:relative;box-shadow:0 10px 50px rgba(0,0,0,0.08);}
.modal-close{position:absolute;top:15px;right:20px;font-size:28px;cursor:pointer;color:#666;transition:color 0.3s;}
.modal-close:hover{color:#d50000;}
.modal h2{color:#d50000;text-align:center;margin:0 0 20px 0;font-size:24px;}
.btn-submit{background:#d50000;color:#fff;border:none;padding:12px;width:100%;border-radius:5px;cursor:pointer;font-weight:600;font-size:16px;margin-top:10px;transition:all 0.3s;box-shadow:0 2px 8px rgba(213,0,0,0.08);}
.btn-submit:hover{background:#b40000;transform:translateY(-3px);box-shadow:0 12px 40px rgba(213,0,0,0.15);}
.btn-submit:active{transform:scale(0.98) translateY(0);box-shadow:0 2px 8px rgba(213,0,0,0.08);}
.btn-checkout-cta{background:#d50000;color:#fff;border:none;padding:18px 24px;width:100%;border-radius:50px;cursor:pointer;font-weight:700;font-size:18px;letter-spacing:1px;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);box-shadow:0 8px 20px rgba(213,0,0,0.2);position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;gap:10px;}
.btn-checkout-cta::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left 0.5s;}
.btn-checkout-cta:hover::before{left:100%;}
.btn-checkout-cta:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(213,0,0,0.3);background:#b40000;}
.btn-checkout-cta:active{transform:translateY(0);box-shadow:0 6px 15px rgba(213,0,0,0.25);}
.btn-checkout-cta .arrow{font-size:20px;transition:transform 0.3s;display:inline-block;}
.btn-checkout-cta:hover .arrow{transform:translateX(5px);animation:bounceArrow 0.6s ease infinite;}
@keyframes bounceArrow{0%,100%{transform:translateX(5px)}50%{transform:translateX(10px)}}
.cart-item{display:grid;grid-template-columns:100px 1fr auto;gap:18px;padding:18px 20px;background:#fff;margin:12px 0;border-radius:12px;align-items:center;box-shadow:0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);transition:all 0.3s ease;border:1px solid #e8e8e8;position:relative;}
.cart-item::before{display:none;}
.cart-item:hover{box-shadow:0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);transform:translateY(-2px);border-color:#d0d0d0;}
.cart-item img{width:90px;height:90px;object-fit:cover;border-radius:8px;border:1px solid #e8e8e8;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition:all 0.3s;grid-column:1;}
.cart-item:hover img{transform:scale(1.03);box-shadow:0 2px 8px rgba(0,0,0,0.15);}
.cart-item-info{display:flex;flex-direction:column;gap:6px;grid-column:2;justify-self:start;}
.cart-item-name{font-size:15px;font-weight:600;color:#1a1a1a;margin:0;line-height:1.3;}
.cart-item-price{font-size:14px;font-weight:500;color:#666;margin-top:2px;}
.cart-item-subtotal{font-size:17px;font-weight:700;color:#d50000;margin-top:4px;}
.cart-item-controls{display:flex;flex-direction:column;align-items:flex-end;gap:10px;grid-column:3;}
.cart-qty-group{display:flex;align-items:center;gap:8px;background:#f5f5f5;padding:6px 10px;border-radius:8px;border:1px solid #e0e0e0;}
.cart-qty-btn{background:#fff;color:#555;border:1px solid #d0d0d0;width:28px;height:28px;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;transition:all 0.2s;display:flex;align-items:center;justify-content:center;}
.cart-qty-btn:hover{border-color:#999;background:#f8f8f8;color:#d50000;}
.cart-qty-btn:active{transform:scale(0.92);background:#eee;}
.cart-qty{font-size:15px;font-weight:600;min-width:30px;text-align:center;color:#1a1a1a;}
.cart-remove-btn{position:absolute;top:10px;right:10px;background:rgba(255,255,255,0.9);color:#999;border:1px solid #e0e0e0;padding:0;cursor:pointer;font-weight:400;transition:all 0.2s;font-size:14px;border-radius:50%;display:flex;align-items:center;justify-content:center;width:26px;height:26px;}
.cart-remove-btn:hover{color:#ff5252;background:#fff;border-color:#ffcdd2;transform:scale(1.1);}
.cart-remove-btn:active{transform:scale(0.9);}
.cart-empty{text-align:center;padding:60px 20px;color:#999;background:#fafafa;border-radius:12px;margin:20px;border:2px dashed #e0e0e0;}
.cart-empty-icon{font-size:80px;margin-bottom:15px;opacity:0.3;}
.cart-footer{background:#fafafa;padding:20px 25px;border-top:2px solid #e5e5e5;}
.cart-summary-items{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #e8e8e8;margin-bottom:12px;color:#666;font-size:14px;}
.cart-total-row{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:18px;padding:15px 0 0;background:transparent;border-radius:0;box-shadow:none;border:none;position:relative;border-top:2px solid #d50000;}
.cart-total-row::before{display:none;}
.form-footer{text-align:center;margin-top:20px;font-size:14px;color:#666;}
.form-footer a{color:#d50000;text-decoration:none;font-weight:600;}

/* FOOTER */
.footer{background:#d50000;color:#fff;margin-top:40px}
.footer-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:30px;padding:40px}
.footer-box h4{margin-top:0;margin-bottom:10px}
.footer-box p{margin:5px 0;font-size:14px}
.footer-bottom{text-align:center;background:#b40000;padding:12px;font-size:13px}

/* Responsive */
@media (max-width: 768px) {
    .form-grid { grid-template-columns: 1fr; }
    .manage-container { padding: 30px 20px; }
    .products { grid-template-columns: repeat(2, 1fr); }
    header { padding: 15px; flex-wrap: wrap; }
    nav { display: none; } /* In real app, use hamburger menu */
}
</style>
</head>
<body>




<!-- Bank Transfer Modal (Popup - Redesigned) -->
<div id="bankTransferModal" class="modal">
  <div class="modal-content" style="max-width:600px; padding: 25px; border-radius: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
    
    <div style="text-align:center; position:relative; margin-bottom:20px;">
        <h2 style="margin:0; font-size:24px; color:#333;">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
        <p style="margin:5px 0 0; color:#666; font-weight:500;">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (Bank Transfer)</p>
        <span class="modal-close" onclick="finishBankTransfer()" style="position:absolute; top:-10px; right:0; font-size:28px; cursor:pointer;">&times;</span>
    </div>

    <div style="display:flex; flex-direction:column; gap:12px;">
        
        <!-- Krungthai -->
        <div style="display:flex; border-radius:12px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
            <div style="width:80px; background:#00a5e5; display:flex; align-items:center; justify-content:center;">
                <div style="background:white; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                    <img src="imgs/2111053mrxt.png" alt="KTB" style="width:100%; height:100%; object-fit:contain;">
                </div>
            </div>
            <div style="flex:1; display:flex; flex-direction:column;">
                <div style="background:white; padding:8px 12px; font-size:12px; line-height:1.4;">
                    <div style="display:flex; justify-content:space-between;">
                         <span style="font-weight:bold; color:#00a5e5; font-size:13px;">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ (Krungthai Bank)</span>
                         <span>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó : ‡∏≠‡∏≠‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</span>
                    </div>
                    <div>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ : <span style="font-weight:bold;">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</span></div>
                </div>
                <div style="background:#0087bd; padding:8px 12px; color:white;">
                    <div style="font-size:12px; opacity:0.8;">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ :</div>
                    <div style="font-size:20px; font-weight:bold; letter-spacing:1px;">662-6-25757-9</div>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer Note -->
    <div style="text-align:center; font-size:13px; color:#666; margin-top:20px; line-height:1.5; background:#f9f9f9; padding:15px; border-radius:10px;">
        ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡πÇ‡∏î‡∏¢‡πÅ‡∏ô‡∏ö ‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô<br>
        ‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏£‡∏∑‡∏≠ Line : <strong style="color:#00c300;">Pranan Tipsuwan</strong> ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô<br>
        <div style="margin-top:10px; font-weight:bold; color:#333;">‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÇ‡∏ó‡∏£. 065-806-7745</div>
    </div>

    <!-- Action Button -->
    <button class="btn-submit" onclick="finishBankTransfer()" style="width:100%; margin-top:15px; background:#b41c1c; color:white; border:none; padding:15px; border-radius:30px; font-size:16px; font-weight:600; cursor:pointer; box-shadow:0 4px 15px rgba(180,28,28,0.3); transition: transform 0.2s;">
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
    </button>
  </div>
</div>

<!-- PromptPay Modal (Popup - Redesigned) -->
<div id="promptPayModal" class="modal">
  <div class="modal-content" style="max-width:380px; padding: 25px; border-radius: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
    
    <!-- Top Header -->
    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom: 20px;">
        <div style="display:flex; align-items:center; gap:5px;">
            <div style="background:#0056ff; color:white; width:24px; height:24px; border-radius:4px; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:14px;">P</div>
            <span style="color:#003d99; font-weight:bold; font-size:16px;">PromptPay</span>
        </div>
        <span class="modal-close" onclick="finishPromptPay()" style="cursor: pointer; color: #999; font-size: 24px; position:static;">&times;</span>
    </div>

    <!-- Title & Amount -->
    <div style="text-align:center; margin-bottom:20px;">
        <div style="font-size:16px; font-weight:600; color:#333;">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢ / ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</div>
        <!-- <div id="promptPayAmountDisplay" style="font-size:32px; font-weight:bold; color:#333; margin-top:5px;">‡∏ø0.00</div> -->
    </div>

    <!-- QR Code -->
    <div style="width:200px; height:200px; margin:0 auto 20px; border:1px solid #48c6ef; border-radius:12px; padding:10px; display:flex; align-items:center; justify-content:center;">
      <img src="imgs/598942189_1397763088809628_1154570086451692649_n.jpg" alt="QR Code" style="width:100%; height:100%; object-fit:contain;">
    </div>

    <!-- Account Details -->
    <div style="text-align:left; margin-bottom:20px;">
        <div style="margin-bottom:15px;">
            <div style="font-size:14px; color:#333; margin-bottom:4px; font-weight:bold;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</div>
            <div style="font-size:16px; color:#666; font-weight:500;">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</div>
        </div>
        
        <div style="margin-bottom:10px;">
             <div style="font-size:14px; color:#333; margin-bottom:4px; font-weight:bold;">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå:</div>
             <div style="background:#f0f2f5; border-radius:8px; padding:12px 15px; display:flex; justify-content:space-between; align-items:center;">
                 <span style="font-size:18px; font-weight:500; color:#333; letter-spacing:0.5px;">065-806-7745</span>
                 <span style="color:#999; cursor:pointer;" title="Copy">üìã</span>
             </div>
        </div>
    </div>

    <!-- Action Button -->
    <button class="btn-submit" onclick="finishPromptPay()" style="width:100%; background:#b41c1c; color:white; border:none; padding:15px; border-radius:30px; font-size:16px; font-weight:600; cursor:pointer; box-shadow:0 4px 15px rgba(180,28,28,0.3); transition: transform 0.2s;">
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
    </button>
  </div>
</div>

<!-- TrueMoney Modal (Popup - Redesigned) -->
<div id="trueMoneyModal" class="modal">
  <div class="modal-content" style="max-width:380px; padding: 25px; border-radius: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
    
    <!-- Top Header -->
    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom: 20px;">
        <div style="display:flex; align-items:center; gap:5px;">
            <div style="background:#f58220; color:white; width:24px; height:24px; border-radius:4px; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:14px;">T</div>
            <span style="color:#f58220; font-weight:bold; font-size:16px;">TrueMoney Wallet</span>
        </div>
        <span class="modal-close" onclick="finishTrueMoney()" style="cursor: pointer; color: #999; font-size: 24px; position:static;">&times;</span>
    </div>

    <!-- Title -->
    <div style="text-align:center; margin-bottom:20px;">
        <div style="font-size:16px; font-weight:600; color:#333;">‡∏ó‡∏£‡∏π‡∏°‡∏±‡∏ô‡∏ô‡∏µ‡πà ‡∏ß‡∏≠‡πÄ‡∏•‡∏ó</div>
    </div>

    <!-- Icon Area -->
    <div style="width:120px; height:120px; margin:0 auto 20px; display:flex; align-items:center; justify-content:center;">
       <img src="imgs/R.png" alt="TrueMoney Wallet" style="width:100%; height:100%; object-fit:contain;">
    </div>

    <!-- Account Details -->
    <div style="text-align:left; margin-bottom:20px;">
        <div style="margin-bottom:15px;">
            <div style="font-size:14px; color:#333; margin-bottom:4px; font-weight:bold;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</div>
            <div style="font-size:16px; color:#666; font-weight:500;">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</div>
        </div>
        
        <div style="margin-bottom:10px;">
             <div style="font-size:14px; color:#333; margin-bottom:4px; font-weight:bold;">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ó‡∏£‡∏π‡∏°‡∏±‡∏ô‡∏ô‡∏µ‡πà:</div>
             <div style="background:#f0f2f5; border-radius:8px; padding:12px 15px; display:flex; justify-content:space-between; align-items:center;">
                 <span style="font-size:18px; font-weight:500; color:#333; letter-spacing:0.5px;">086-396-4181</span>
                 <span style="color:#999; cursor:pointer;" title="Copy">üìã</span>
             </div>
        </div>
    </div>

    <!-- Action Button -->
    <button class="btn-submit" onclick="finishTrueMoney()" style="width:100%; background:#b41c1c; color:white; border:none; padding:15px; border-radius:30px; font-size:16px; font-weight:600; cursor:pointer; box-shadow:0 4px 15px rgba(180,28,28,0.3); transition: transform 0.2s;">
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
    </button>
  </div>
</div>


<header>
  <div class="logo">PRANAN SHOP</div>

  <div class="search"><input id="product-search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."></div>
  <nav>
    <a href="#" onclick="switchPage('home'); return false;">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    <div class="dropdown" id="categoryDropdown">
      <span class="dropdown-toggle" onclick="toggleDropdown(event)">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</span>
      <div class="dropdown-menu">
        <a href="#" onclick="filterByCategory(event, 'computer')">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</a>
        <a href="#" onclick="filterByCategory(event, 'case')">‡πÄ‡∏Ñ‡∏™‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</a>
        <a href="#" onclick="filterByCategory(event, 'notebook')">‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ</a>
        <a href="#" onclick="filterByCategory(event, 'storage')">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
        <a href="#" onclick="filterByCategory(event, 'mobile')">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</a>
        <a href="#" onclick="filterByCategory(event, 'accessories')">‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏≤‡∏™‡πå</a>
        <a href="#" onclick="filterByCategory(event, 'monitor')">‡∏à‡∏≠‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå</a>
        <a href="#" onclick="filterByCategory(event, 'audio')">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á</a>
        <a href="#" onclick="filterByCategory(event, 'gaming')">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á</a>
        <a href="#" onclick="filterByCategory(event, 'camera')">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</a>
      </div>
    </div>
    <a href="#" id="nav-manage" onclick="switchPage('manage'); return false;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
    <a href="#" id="nav-stock" onclick="switchPage('stock'); return false;">‡∏™‡∏ï‡πá‡∏≠‡∏Å</a>
    <a href="#" onclick="switchPage('contact'); return false;">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</a>
  </nav>
  <button class="login-btn" onclick="openLoginModal()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <button id="adminBtn" class="admin-btn" onclick="openAdminModal()">Admin</button>
  <div class="cart" onclick="openCartModal()" style="cursor:pointer;">üõí<span id="cartCount" style="display:none;">0</span></div>
</header>

<main>
  <div id="view-home">
      <div class="carousel-container">
          <div class="carousel-wrapper" id="carouselWrapper">
              <div class="carousel-slide"><img src="imgs/apple-logo-iphone-12-iphone-12-pro-iphone-12-pro-max-iphone-3840x2160-3273.jpg" alt="Slide 1"></div>
              <div class="carousel-slide"><img src="imgs/amd-radeon-3840x2160-10591.jpg" alt="Slide 2"></div>
              <div class="carousel-slide"><img src="imgs/nvidia-geforce-rtx-3840x2160-19512.png" alt="Slide 3"></div>
              <div class="carousel-slide"><img src="imgs/1.png" alt="Slide 4"></div>
              <div class="carousel-slide"><img src="imgs/2.png" alt="Slide 5"></div>
          </div>
          <button class="carousel-btn carousel-btn-prev" onclick="moveCarousel(-1)">‚Äπ</button>
          <button class="carousel-btn carousel-btn-next" onclick="moveCarousel(1)">‚Ä∫</button>
          <div class="carousel-indicators">
              <span class="carousel-indicator active" onclick="goToSlide(0)"></span>
              <span class="carousel-indicator" onclick="goToSlide(1)"></span>
              <span class="carousel-indicator" onclick="goToSlide(2)"></span>
              <span class="carousel-indicator" onclick="goToSlide(3)"></span>
              <span class="carousel-indicator" onclick="goToSlide(4)"></span>
          </div>
      </div>

      <div class="section-title" id="productSectionTitle">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>

      <div class="content">
        <div class="products">
          </div>
      </div>
  </div>

  <div id="view-manage" style="display:none;">
    <div class="manage-container">
        <div class="manage-header">
            <h2>üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <p>‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        <form id="manageProductForm" onsubmit="handleManageProduct(event)">
            <div class="form-grid">
                <div class="form-left">
                    <div class="preview-box" id="imgPreview">
                        <span>‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span>
                    </div>
                    <p class="preview-hint">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà URL</p>
                </div>

                <div class="form-right">
                    <div class="form-group">
                        <label for="product_image_file">üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                        <input type="file" id="product_image_file" name="image_file" accept="image/*" onchange="handleFileSelect(event)" style="padding:8px;border:2px solid #e0e0e0;border-radius:10px;background:#fff;cursor:pointer;">
                        <small style="color:#999;font-size:12px;display:block;margin-top:5px;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: JPG, PNG, GIF, WEBP</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="product_image">üñºÔ∏è ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                        <input type="url" id="product_image" name="image_url" placeholder="https://example.com/image.jpg" oninput="updatePreviewFromURL(this.value)">
                    </div>

                    <div class="form-group">
                        <label for="product_name">üì¶ ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                        <input type="text" id="product_name" name="product_name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô iPhone 15 Pro Max">
                    </div>

                    <div class="form-group">
                        <label for="product_category">üè∑Ô∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                        <select id="product_category" name="category" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà...</option>
                            <option value="computer">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                            <option value="case">‡πÄ‡∏Ñ‡∏™‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                            <option value="notebook">‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ</option>
                            <option value="storage">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                            <option value="mobile">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</option>
                            <option value="accessories">‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏≤‡∏™‡πå</option>
                            <option value="monitor">‡∏à‡∏≠‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                            <option value="audio">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
                            <option value="gaming">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á</option>
                            <option value="camera">‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</option>
                        </select>
                    </div>

                    <div class="input-row">
                        <div class="form-group">
                            <label for="product_price">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="product_price" name="price" required placeholder="0.00" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="product_stock">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</label>
                            <input type="number" id="product_stock" name="stock" required placeholder="0" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="product_desc">üìù ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                        <textarea id="product_desc" name="description" rows="4" required placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥..."></textarea>
                    </div>

                    <div class="action-buttons">
                        <button type="button" class="btn-cancel" onclick="switchPage('home')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="btn-save">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
  </div>

  <div id="view-stock" style="display:none;">
    <div class="stock-container">
        <div class="stock-header">
            <h2>üìä ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
        </div>

        <div class="stock-stats">
            <div class="stat-card">
                <div class="icon"></div>
                <div class="number" id="total-products">20</div>
                <div class="label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
            <div class="stat-card">
                <div class="icon"></div>
                <div class="number" id="in-stock">15</div>
                <div class="label">‡∏°‡∏µ‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</div>
            </div>
            <div class="stat-card">
                <div class="icon"></div>
                <div class="number" id="low-stock">3</div>
                <div class="label">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>
            </div>
            <div class="stat-card">
                <div class="icon"></div>
                <div class="number" id="out-stock">2</div>
                <div class="label">‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</div>
            </div>
        </div>

        <div class="stock-table-wrapper">
            <table class="stock-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                        <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="stock-table-body">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
  </div>

  <div id="view-contact" style="display:none;">
    <div class="contact-container">
        <div class="contact-header">
            <h2>üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h2>
            <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢</p>
        </div>

        <div class="contact-content">
            <div class="contact-info">
                <div class="info-card">
                    <div class="icon">üìç</div>
                    <h3>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h3>
                    <p>278 ‡∏´‡∏°‡∏π‡πà12 ‡∏ï‡∏≥‡∏ö‡∏•‡∏ô‡∏≤‡∏ï‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏≤<br>
                    ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÇ‡∏û‡∏ô‡∏ô‡∏≤‡πÅ‡∏Å‡πâ‡∏ß<br>
                    ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£ 47230</p>
                </div>

                <div class="info-card">
                    <div class="icon">üìß</div>
                    <h3>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h3>
                    <p>pranan250@gmail.com<br>
                    pranan250@gmail.com</p>
                </div>

                <div class="info-card">
                    <div class="icon">üì±</div>
                    <h3>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</h3>
                    <p>Tel: 065-806-7745<br>
                    Mobile: 065-806-7745<br>
                    Line: Pranan Tipsuwan</p>
                </div>

                <div class="info-card">
                    <div class="icon">üïê</div>
                    <h3>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</h3>
                    <p>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏®‡∏∏‡∏Å‡∏£‡πå: 09:00 - 18:00<br>
                    ‡πÄ‡∏™‡∏≤‡∏£‡πå - ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå: 10:00 - 17:00<br>
                    <span style="color:#d50000;font-weight:600;">‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span></p>
                </div>
            </div>

            <div class="contact-form">
                <h3>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡πÄ‡∏£‡∏≤</h3>
                <form onsubmit="handleContactForm(event)">
                    <div class="form-group-contact">
                        <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" id="contact_name" required placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    </div>

                    <div class="form-group-contact">
                        <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" id="contact_email" required placeholder="your@email.com">
                    </div>

                    <div class="form-group-contact">
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" id="contact_phone" placeholder="08x-xxx-xxxx">
                    </div>

                    <div class="form-group-contact">
                        <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
                        <textarea id="contact_message" required placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                    </div>

                    <button type="submit" class="btn-send">üì® ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                </form>
            </div>
        </div>

        <div class="contact-map">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3875.038863550042!2d100.64254931483082!3d13.781182590326808!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x311d61a3c5b5d5a5%3A0x40100b25de24b90!2sBangkok%2C%20Thailand!5e0!3m2!1sen!2sth!4v1234567890123!5m2!1sen!2sth" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </div>
  </div>

  <!-- PRODUCT DETAIL PAGE VIEW -->
  <div id="view-product-detail" style="display:none; padding-top: 20px;">
      <div id="product-detail-page-content" class="manage-container" style="max-width: 1200px; padding: 40px;">
          <!-- Content will be injected here -->
      </div>
  </div>

</main>



<div id="loginModal" class="modal">
  <div class="modal-content" style="max-width:450px; padding: 0; border-radius: 20px; font-family: 'Segoe UI', sans-serif; overflow:hidden;">
    
    <!-- Header with Back & Close -->
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 15px 20px;">
        <div style="flex:1;"></div>
        <div class="modal-close" onclick="closeLoginModal()" style="position:static; width:30px; height:30px; background:#ccc; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold; cursor:pointer;">&times;</div>
    </div>

    <div style="padding: 0 40px 40px 40px;">
    
        <!-- Logo Area -->
        <div style="text-align:center; margin-bottom:20px;">
            <h1 style="color:#00a5e5; font-style:italic; font-weight:800; font-size:40px; margin:0; letter-spacing:-1px;">
                <span style="color:#d50000;">PRANAN</span> Shop
            </h1>
            <p style="color:#00a5e5; font-size:16px; margin:5px 0; font-weight:600;">
                ‚Äú‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏° <span style="color:#00a5e5;">‡πÑ‡∏≠‡∏ó‡∏µ ‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡πÇ‡∏ü‡∏ô</span>‚Äù
            </p>
            <p style="color:#666; font-size:12px; margin:0;">‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ | ‡∏Ñ‡∏£‡∏ö | ‡∏à‡∏ö‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>

        <div style="text-align:center; margin-bottom:20px;">
            <h2 style="margin:0; font-size:22px; font-weight:700; color:#333;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
        </div>

        <!-- Email Form (Direct) -->
        <div style="margin-top:20px;">
            <form id="loginForm" onsubmit="handleLogin(event)">
              <div style="margin-bottom:15px;">
                <input type="text" id="username" name="username" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
              </div>
              <div style="margin-bottom:20px;">
                <input type="password" id="password" name="password" required placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
              </div>
              <button type="submit" class="btn-submit" style="width:100%;padding:12px;border-radius:30px;font-size:16px;box-shadow:none; background:#d50000; color:#fff;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            </form>
            <div style="text-align:right; margin-top:10px;">
                <a href="#" onclick="event.preventDefault();closeLoginModal();openForgotPasswordModal()" style="font-size:13px; color:#666; text-decoration:none;">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
            </div>
        </div>

        <!-- Footer Common -->
        <div style="text-align:center; margin-top:30px; font-size:14px; color:#666;">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ? <a href="#" onclick="event.preventDefault();closeLoginModal();openRegisterModal()" style="color:#00a5e5; text-decoration:underline; font-weight:600;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏•‡∏¢</a>
        </div>

        <div style="text-align:center; margin-top:20px; font-size:11px; color:#999; line-height:1.4;">
            ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö <a href="#" style="color:#00a5e5;text-decoration:underline;">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a> ‡∏Ç‡∏≠‡∏á PRANAN SHOP ‡πÅ‡∏•‡πâ‡∏ß
        </div>

    </div>
  </div>
</div>



<div id="logoutModal" class="modal">
  <div class="modal-content" style="max-width:450px; padding: 0; border-radius: 20px; font-family: 'Segoe UI', sans-serif; overflow:hidden;">
    
    <!-- Header with Close -->
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 15px 20px;">
        <div style="flex:1;"></div>
        <div class="modal-close" onclick="closeLogoutModal()" style="position:static; width:30px; height:30px; background:#ccc; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold; cursor:pointer;">&times;</div>
    </div>

    <div style="padding: 0 40px 40px 40px;">

        <div style="text-align:center; margin-bottom:20px;">
            <h2 style="margin:0; font-size:22px; font-weight:700; color:#333;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <p style="color:#666;font-size:14px;margin-top:5px;">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
        </div>

        <div style="display:flex; gap:10px; margin-top:25px;">
            <button onclick="closeLogoutModal()" style="flex:1; padding:12px; border-radius:30px; border:none; background:#f0f0f0; color:#333; font-weight:600; cursor:pointer; font-size:16px; transition:background 0.2s;" onmouseover="this.style.background='#e0e0e0'" onmouseout="this.style.background='#f0f0f0'">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button onclick="handleLogout()" style="flex:1; padding:12px; border-radius:30px; border:none; background:#d50000; color:#fff; font-weight:600; cursor:pointer; font-size:16px; box-shadow:0 4px 15px rgba(213,0,0,0.3); transition:all 0.2s;" onmouseover="this.style.background='#b40000';this.style.transform='translateY(-2px)'" onmouseout="this.style.background='#d50000';this.style.transform='translateY(0)'">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>

    </div>
  </div>
</div>

<div id="registerModal" class="modal">
  <div class="modal-content" style="max-width:450px; padding: 0; border-radius: 20px; font-family: 'Segoe UI', sans-serif; overflow:hidden;">
    
    <!-- Header with Back & Close -->
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 15px 20px;">
        <div style="flex:1;"></div>
        <div class="modal-close" onclick="closeRegisterModal()" style="position:static; width:30px; height:30px; background:#ccc; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold; cursor:pointer;">&times;</div>
    </div>

    <div style="padding: 0 40px 40px 40px;">
    
        <!-- Logo Area -->
        <div style="text-align:center; margin-bottom:20px;">
            <h1 style="color:#00a5e5; font-style:italic; font-weight:800; font-size:40px; margin:0; letter-spacing:-1px;">
                <span style="color:#d50000;">PRANAN</span> Shop
            </h1>
            <p style="color:#00a5e5; font-size:16px; margin:5px 0; font-weight:600;">
                ‚Äú‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏° <span style="color:#00a5e5;">‡πÑ‡∏≠‡∏ó‡∏µ ‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡πÇ‡∏ü‡∏ô</span>‚Äù
            </p>
            <p style="color:#666; font-size:12px; margin:0;">‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ | ‡∏Ñ‡∏£‡∏ö | ‡∏à‡∏ö‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>

        <div style="text-align:center; margin-bottom:20px;">
            <h2 style="margin:0; font-size:22px; font-weight:700; color:#333;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
        </div>

        <!-- Email Form (Direct) -->
        <div style="margin-top:20px;">
            <form id="registerForm" onsubmit="handleRegister(event)">
              <div style="margin-bottom:15px;">
                <input type="text" id="reg_fullname" name="fullname" required placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
              </div>
              <div style="margin-bottom:15px;">
                <input type="email" id="reg_email" name="email" required placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
              </div>
              <div style="margin-bottom:20px;">
                <input type="password" id="reg_password" name="password" required placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
              </div>
              <button type="submit" class="btn-submit" style="width:100%;padding:12px;border-radius:30px;font-size:16px;box-shadow:none; background:#d50000; color:#fff;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            </form>
        </div>

        <!-- Footer Common -->
        <div style="text-align:center; margin-top:30px; font-size:14px; color:#666;">
            ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? <a href="#" onclick="event.preventDefault();closeRegisterModal();openLoginModal()" style="color:#00a5e5; text-decoration:underline; font-weight:600;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>

        <div style="text-align:center; margin-top:20px; font-size:11px; color:#999; line-height:1.4;">
            ‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö<br><a href="#" style="color:#00a5e5;text-decoration:underline;">‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</a> ‡∏Ç‡∏≠‡∏á PRANAN SHOP ‡πÅ‡∏•‡πâ‡∏ß
        </div>

    </div>
  </div>
</div>

<div id="forgotPasswordModal" class="modal">
  <div class="modal-content" style="max-width:450px; padding: 0; border-radius: 20px; font-family: 'Segoe UI', sans-serif; overflow:hidden;">
    
    <!-- Header with Close -->
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 15px 20px;">
        <div style="flex:1;"></div>
        <div class="modal-close" onclick="closeForgotPasswordModal()" style="position:static; width:30px; height:30px; background:#ccc; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold; cursor:pointer;">&times;</div>
    </div>

    <div style="padding: 0 40px 40px 40px;">
    
        <!-- Logo Area -->
        <div style="text-align:center; margin-bottom:20px;">
            <h1 style="color:#00a5e5; font-style:italic; font-weight:800; font-size:40px; margin:0; letter-spacing:-1px;">
                <span style="color:#d50000;">PRANAN</span> Shop
            </h1>
            <p style="color:#00a5e5; font-size:16px; margin:5px 0; font-weight:600;">
                ‚Äú‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏° <span style="color:#00a5e5;">‡πÑ‡∏≠‡∏ó‡∏µ ‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡πÇ‡∏ü‡∏ô</span>‚Äù
            </p>
            <p style="color:#666; font-size:12px; margin:0;">‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ | ‡∏Ñ‡∏£‡∏ö | ‡∏à‡∏ö‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>

        <div style="text-align:center; margin-bottom:20px;">
             <h2 style="margin:0; font-size:22px; font-weight:700; color:#333;">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
             <p style="text-align:center;color:#666;font-size:14px;margin-top:5px;">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</p>
        </div>

        <form id="forgotPasswordForm" onsubmit="handleForgotPassword(event)">
          <div style="margin-bottom:15px;">
            <input type="text" id="forgot_username" name="username" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
          </div>
          <div style="margin-bottom:15px;">
            <input type="password" id="forgot_new_password" name="new_password" required placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
          </div>
          <div style="margin-bottom:20px;">
            <input type="password" id="forgot_confirm_password" name="confirm_password" required placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
          </div>
          <button type="submit" class="btn-submit" style="width:100%;padding:12px;border-radius:30px;font-size:16px;box-shadow:none; background:#d50000; color:#fff;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
        </form>

        <!-- Footer Common -->
        <div style="text-align:center; margin-top:30px; font-size:14px; color:#666;">
            ‡∏à‡∏≥‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß? <a href="#" onclick="event.preventDefault();closeForgotPasswordModal();openLoginModal()" style="color:#00a5e5; text-decoration:underline; font-weight:600;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>

    </div>
  </div>
</div>


<!-- Admin Password Modal -->
<div id="adminModal" class="modal">
  <div class="modal-content" style="max-width:450px; padding: 0; border-radius: 20px; font-family: 'Segoe UI', sans-serif; overflow:hidden;">
    
    <!-- Header with Close -->
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 15px 20px;">
        <div style="flex:1;"></div>
        <div class="modal-close" onclick="closeAdminModal()" style="position:static; width:30px; height:30px; background:#ccc; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold; cursor:pointer;">&times;</div>
    </div>

    <div style="padding: 0 40px 40px 40px;">
    
        <!-- Logo Area -->
        <div style="text-align:center; margin-bottom:20px;">
            <h1 style="color:#00a5e5; font-style:italic; font-weight:800; font-size:40px; margin:0; letter-spacing:-1px;">
                <span style="color:#d50000;">PRANAN</span> Shop
            </h1>
            <p style="color:#00a5e5; font-size:16px; margin:5px 0; font-weight:600;">
                ‚Äú‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏° <span style="color:#00a5e5;">‡πÑ‡∏≠‡∏ó‡∏µ ‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡πÇ‡∏ü‡∏ô</span>‚Äù
            </p>
            <p style="color:#666; font-size:12px; margin:0;">‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ | ‡∏Ñ‡∏£‡∏ö | ‡∏à‡∏ö‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>

        <div style="text-align:center; margin-bottom:20px;">
            <div style="width:50px;height:50px;background:#ffebee;color:#d50000;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;margin:0 auto 10px;">
            üîê
            </div>
            <h2 style="margin:0; font-size:22px; font-weight:700; color:#333;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</h2>
            <p style="color:#666;font-size:14px;margin-top:5px;">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
        </div>

        <form id="adminForm" onsubmit="handleAdminLogin(event)">
          <div style="margin-bottom:15px;">
            <input type="email" id="admin_email" name="admin_email" required placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" autocomplete="off" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
          </div>
          <div style="margin-bottom:20px;">
            <input type="password" id="admin_password" name="admin_password" required placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" autocomplete="off" style="width:100%;padding:12px 15px;border:1px solid #e0e0e0;border-radius:30px;font-size:15px;outline:none;background:#f9f9f9;">
          </div>
          <button type="submit" class="btn-submit" style="width:100%;padding:12px;border-radius:30px;font-size:16px;box-shadow:none; background:linear-gradient(135deg,#d50000,#b40000); color:#fff;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
        </form>

    </div>
  </div>
</div>


<!-- Cart Modal -->
<div id="cartModal" class="modal">
  <div class="modal-content" style="max-width:800px;border-radius:25px;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
    <span class="modal-close" onclick="closeCartModal()" style="font-size:35px;width:45px;height:45px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:rgba(255,0,0,0.1);transition:all 0.3s;">&times;</span>
    <h2 style="background:linear-gradient(135deg,#d50000,#ff6b6b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:32px;margin-bottom:25px;text-align:center;font-weight:800;letter-spacing:1px;">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
    <div id="cartItems" style="max-height:400px;overflow-y:auto;padding:0 20px;">
      <!-- Cart items will be inserted here -->
      <div class="cart-empty">
        <div class="cart-empty-icon">üõí</div>
        <p style="font-size:22px;font-weight:700;margin:15px 0;color:#666;">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>
        <p style="font-size:16px;opacity:0.7;color:#999;line-height:1.6;">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤<br>‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
        <button onclick="closeCartModal()" style="margin-top:20px;background:linear-gradient(135deg,#d50000,#ff6b6b);color:#fff;border:none;padding:12px 30px;border-radius:25px;cursor:pointer;font-weight:600;font-size:16px;box-shadow:0 5px 15px rgba(213,0,0,0.3);transition:all 0.3s;">üõçÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</button>
      </div>
    </div>
    <div class="cart-footer">
      <div class="cart-summary-items">
        <span>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
        <span id="cartItemCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
      </div>
      <div class="cart-total-row">
        <span style="font-size:17px;font-weight:700;color:#1a1a1a;z-index:1;position:relative;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
        <span id="cartTotal" style="font-size:26px;font-weight:800;color:#d50000;z-index:1;position:relative;letter-spacing:0.5px;">‡∏ø0</span>
      </div>
      <button class="btn-checkout-cta" onclick="checkout()">
        <span>üí≥ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
        <span class="arrow">‚Üí</span>
      </button>
    </div>
  </div>
</div>

<!-- Checkout Modal -->
<div id="checkoutModal" class="modal">
  <div class="modal-content" style="max-width:900px; padding: 0; border-radius: 20px; font-family: 'Segoe UI', sans-serif; overflow:hidden;">
    
    <!-- Header with Close -->
    <div style="display:flex; justify-content:space-between; align-items:center; padding: 20px 30px; border-bottom:1px solid #f0f0f0;">
        <h3 style="margin:0;font-size:20px;font-weight:700;color:#333;">üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á & ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
        <div class="modal-close" onclick="closeCheckoutModal()" style="position:static; width:36px; height:36px; background:#f0f0f0; color:#333; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:20px; font-weight:bold; cursor:pointer; transition:all 0.2s;">&times;</div>
    </div>

    <div style="max-height:80vh; overflow-y:auto; background:#fff;">
      <form id="checkoutForm" onsubmit="submitOrder(event)" style="display:flex; flex-wrap:wrap;">
        
        <!-- Left Column: Shipping Info -->
        <div style="flex:1; min-width:350px; padding: 30px; border-right:1px solid #f0f0f0;">
             <h4 style="margin:0 0 20px; color:#d50000; font-size:16px; border-left:4px solid #d50000; padding-left:10px;">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h4>
             
            <div style="margin-bottom:20px;">
               <label style="display:block;margin-bottom:8px;font-size:13px;font-weight:600;color:#555;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label>
               <div style="position:relative;">
                  <span style="position:absolute;left:15px;top:50%;transform:translateY(-50%);font-size:16px;">üë§</span>
                  <input type="text" id="fullName" required style="width:100%;padding:12px 15px 12px 45px;border:1px solid #eee;border-radius:12px;font-size:14px;outline:none;background:#f9f9f9;transition:all 0.2s;" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" onfocus="this.style.background='#fff';this.style.borderColor='#d50000';this.style.boxShadow='0 4px 12px rgba(213,0,0,0.1)'" onblur="this.style.background='#f9f9f9';this.style.borderColor='#eee';this.style.boxShadow='none'">
               </div>
            </div>

            <div style="margin-bottom:20px;">
               <label style="display:block;margin-bottom:8px;font-size:13px;font-weight:600;color:#555;">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
               <div style="position:relative;">
                  <span style="position:absolute;left:15px;top:50%;transform:translateY(-50%);font-size:16px;">üìû</span>
                  <input type="tel" id="phone" required pattern="[0-9]{10}" style="width:100%;padding:12px 15px 12px 45px;border:1px solid #eee;border-radius:12px;font-size:14px;outline:none;background:#f9f9f9;transition:all 0.2s;" placeholder="0xx-xxx-xxxx" onfocus="this.style.background='#fff';this.style.borderColor='#d50000';this.style.boxShadow='0 4px 12px rgba(213,0,0,0.1)'" onblur="this.style.background='#f9f9f9';this.style.borderColor='#eee';this.style.boxShadow='none'">
               </div>
            </div>

            <div style="margin-bottom:20px;">
               <label style="display:block;margin-bottom:8px;font-size:13px;font-weight:600;color:#555;">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
               <div style="position:relative;">
                  <span style="position:absolute;left:15px;top:15px;font-size:16px;">üìç</span>
                  <textarea id="address" required rows="4" style="width:100%;padding:12px 15px 12px 45px;border:1px solid #eee;border-radius:12px;font-size:14px;resize:vertical;background:#f9f9f9;outline:none;transition:all 0.2s;line-height:1.5;" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ñ‡∏ô‡∏ô, ‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•, ‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" onfocus="this.style.background='#fff';this.style.borderColor='#d50000';this.style.boxShadow='0 4px 12px rgba(213,0,0,0.1)'" onblur="this.style.background='#f9f9f9';this.style.borderColor='#eee';this.style.boxShadow='none'"></textarea>
               </div>
            </div>
        </div>

        <!-- Right Column: Payment Info -->
        <div style="flex:1; min-width:350px; padding: 30px; background:#fafafa;">
            <h4 style="margin:0 0 20px; color:#d50000; font-size:16px; border-left:4px solid #d50000; padding-left:10px;">üí≥ ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h4>

            <div style="margin-bottom:25px;">
               <label style="display:block;margin-bottom:8px;font-size:13px;font-weight:600;color:#555;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
               <div style="position:relative;">
                 <span style="position:absolute;left:15px;top:50%;transform:translateY(-50%);font-size:16px;z-index:1;">üí≥</span>
                 <select id="paymentMethod" required style="width:100%;padding:12px 15px 12px 45px;border:1px solid #eee;border-radius:12px;font-size:14px;background:#f9f9f9;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;transition:all 0.2s;" onfocus="this.style.background='#fff';this.style.borderColor='#d50000';this.style.boxShadow='0 4px 12px rgba(213,0,0,0.1)'" onblur="this.style.background='#f9f9f9';this.style.borderColor='#eee';this.style.boxShadow='none'">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô...</option>
                    <option value="cod">üíµ ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (COD)</option>
                    <option value="transfer">üè¶ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</option>
                    <option value="promptpay">üì± ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢ (PromptPay)</option>
                    <option value="truemoney">üí∏ ‡∏ó‡∏£‡∏π‡∏°‡∏±‡∏ô‡∏ô‡∏µ‡πà ‡∏ß‡∏≠‡πÄ‡∏•‡∏ó (TrueMoney)</option>
                 </select>
                 <span style="position:absolute;right:15px;top:50%;transform:translateY(-50%);font-size:12px;color:#999;pointer-events:none;">‚ñº</span>
               </div>
            </div>
            
            <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
            <div id="paymentDetails" style="display:none;margin-bottom:20px;padding:15px;background:#fff;border-radius:12px;border:1px solid #ffcdd2;font-size:14px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
                <div id="payment-truemoney" style="display:none;">
                    <div style="font-weight:700;color:#d50000;margin-bottom:5px;">TrueMoney Wallet</div>
                    <div style="font-size:13px;color:#555;">086-396-4181</div>
                    <div style="font-size:13px;color:#555;">‡∏ô.‡∏™. ‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</div>
                </div>
                <div id="payment-promptpay" style="display:none;">
                   <img src="imgs/598942189_1397763088809628_1154570086451692649_n.jpg" alt="PromptPay QR Code" style="max-width:150px; width:100%; height:auto; border-radius:8px; margin-bottom:10px;">
                   <div style="font-weight:700;color:#0056b3;margin-bottom:5px;">PromptPay</div>
                   <div style="font-size:13px;color:#555;">065-806-7745</div>
                   <div style="font-size:13px;color:#555;">‡∏ô.‡∏™. ‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</div>
                </div>
                 <div id="payment-transfer" style="display:none;">
                   <div style="font-weight:700;color:#28a745;margin-bottom:5px;">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</div>
                   <div style="font-size:13px;color:#555;">‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ 662-6-25757-9</div>
                   <div style="font-size:13px;color:#555;">‡∏ô.‡∏™. ‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</div>
                </div>
            </div>

            <!-- Slip Upload Section -->
            <div id="slipUploadSection" style="display:none; margin-bottom:20px;">
               <label style="display:block;margin-bottom:8px;font-size:13px;font-weight:600;color:#555;">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏•‡∏¥‡∏õ)</label>
               <div style="position:relative; border:2px dashed #ddd; border-radius:12px; padding:20px; text-align:center; background:#fff; transition:all 0.2s; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center;" onmouseover="this.style.borderColor='#d50000';this.style.background='#fff'" onmouseout="this.style.borderColor='#ddd';this.style.background='#fff'">
                   <input type="file" id="paymentSlip" accept="image/*" style="opacity:0; position:absolute; top:0; left:0; width:100%; height:100%; cursor:pointer; z-index:10;" onchange="handleSlipPreview(this)">
                   <div id="slipIcon" style="font-size:30px; margin-bottom:8px; color:#ccc;">üì∑</div>
                   <img id="slipPreviewImg" style="display:none; max-width:100%; max-height:150px; border-radius:8px; margin-bottom:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                   <span id="slipFileName" style="font-size:14px; color:#666; font-weight:500;">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</span>
               </div>
            </div>

            <div style="background:#fff; border-radius:15px; padding:20px; margin-bottom:20px; border:1px solid #e0e0e0; box-shadow:0 4px 15px rgba(0,0,0,0.05);">
                 <div style="display:flex; justify-content:space-between; align-items:end;">
                     <span style="font-size:16px;font-weight:700;color:#333;">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                     <span id="checkoutTotal" style="font-size:26px;font-weight:800;color:#d50000;line-height:1;">‡∏ø0</span>
                 </div>
            </div>

            <button type="submit" class="btn-submit" style="width:100%;padding:15px;border-radius:12px;font-size:16px;box-shadow:0 8px 20px rgba(213,0,0,0.2); background:linear-gradient(135deg, #d50000, #b40000); color:#fff; cursor:pointer; font-weight:700;transition:all 0.3s; border:none; display:flex; align-items:center; justify-content:center; gap:10px;">
                <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
                <span>‚ûú</span>
            </button>
        </div>

      </form>

    </div>
  </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
  <div class="modal-content" style="max-width:450px;text-align:center;padding:30px 25px;">
    <h2 style="color:#28a745;margin-bottom:12px;font-size:24px;">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
    <p style="color:#666;font-size:14px;line-height:1.5;margin-bottom:20px;">
      ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏ß‡πâ‡∏ß‡∏≤‡∏á‡πÉ‡∏à‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤<br>
      ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    </p>
    <div id="orderSummary" style="background:#f8f9fa;padding:15px;border-radius:10px;margin-bottom:20px;text-align:left;font-size:13px;"></div>
    <button onclick="closeSuccessModal()" style="background:#d50000;color:#fff;border:none;padding:12px 35px;border-radius:50px;cursor:pointer;font-weight:700;font-size:15px;box-shadow:0 4px 15px rgba(213,0,0,0.2);transition:all 0.3s;">
      ‡∏ï‡∏Å‡∏•‡∏á
    </button>
  </div>
</div>

<!-- Bank Transfer Modal -->
<div id="bankTransferModal" class="modal">
  <div class="modal-content" style="max-width:400px;text-align:center;padding:30px;">
    <h3 style="color:#d50000;margin-top:0;">üè¶ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</h3>
    <div style="margin:20px 0;">
      <!-- <img src="" alt="KTB Bank" style="width:80px;height:80px;object-fit:contain;margin-bottom:10px;"> -->
      <div style="font-weight:bold;font-size:18px;color:#00a5e5;">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢</div>
      <div style="background:#f0f8ff;padding:15px;border-radius:10px;margin:15px 0;border:1px solid #bce0fd;">
        <div style="font-size:14px;color:#666;">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
        <div style="font-size:24px;font-weight:bold;color:#333;margin:5px 0;letter-spacing:1px;">662-6-25757-9</div>
        <div style="font-size:14px;color:#666;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
        <div style="font-size:16px;font-weight:600;color:#333;">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</div>
      </div>
      <p style="font-size:13px;color:#888;">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô<br>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
    </div>
    <button onclick="finishBankTransfer()" style="background:#d50000;color:#fff;border:none;padding:12px 40px;border-radius:50px;cursor:pointer;font-weight:700;font-size:16px;box-shadow:0 4px 15px rgba(213,0,0,0.2);transition:all 0.3s;width:100%;">
      ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
    </button>
  </div>
</div>

<!-- PromptPay Modal -->
<div id="promptPayModal" class="modal">
  <div class="modal-content" style="max-width:400px;text-align:center;padding:30px;">
    <h3 style="color:#d50000;margin-top:0;"> ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</h3>
    <div style="margin:20px 0;">
      <img src="imgs/598942189_1397763088809628_1154570086451692649_n.jpg" alt="PromptPay QR" style="width:250px;border-radius:10px;margin-bottom:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);">
      <div style="background:#f0f8ff;padding:15px;border-radius:10px;margin:15px 0;border:1px solid #bce0fd;">
        <div style="font-size:14px;color:#666;">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</div>
        <div style="font-size:24px;font-weight:bold;color:#333;margin:5px 0;letter-spacing:1px;">065-806-7745</div>
        <div style="font-size:14px;color:#666;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
        <div style="font-size:16px;font-weight:600;color:#333;">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏£‡∏≤‡∏ì‡∏±‡∏ô‡∏ï‡πå ‡∏ó‡∏¥‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì</div>
      </div>
      <p style="font-size:13px;color:#888;">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô<br>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
    </div>
    <button onclick="finishPromptPay()" style="background:#d50000;color:#fff;border:none;padding:12px 40px;border-radius:50px;cursor:pointer;font-weight:700;font-size:16px;box-shadow:0 4px 15px rgba(213,0,0,0.2);transition:all 0.3s;width:100%;">
      ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
    </button>
  </div>
</div>

<style>
@keyframes successPop {
  0% { transform: scale(0); opacity: 0; }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); opacity: 1; }
}
</style>

<footer class="footer">
  <div class="footer-container">
    <div class="footer-box">
      <h4>PRANAN SHOP</h4>
      <p>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏≠‡∏ó‡∏µ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå<br>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå</p>
    </div>
    <div class="footer-box">
      <h4>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h4>
      <p>üìû ‡πÇ‡∏ó‡∏£: .065-806-7745</p>
      <p>üìß Email: pranan250@gmailcom</p>
      <p>üí¨ Line: Pranan Tipsuwan</p>
    </div>
    <div class="footer-box">
      <h4>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏≤</h4>
      <p>Facebook: ‡∏û‡∏π‡πà ‡∏Ø.</p>
      <p>Instagram: pranan_69</p>
      <p>TikTok: @pranan69</p>
    </div>
  </div>
  <div style="padding:12px 40px;display:flex;justify-content:flex-start;align-items:center;gap:20px;flex-wrap:wrap">
    <div id="visitor-counter" style="background:#fff;color:#d50000;border-radius:12px;padding:8px 12px;font-weight:600;display:inline-block;margin-right:12px">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°: <span id="visitor-count">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span></div>
    <div class="footer-bottom" style="background:#b40000;padding:12px;font-size:13px;flex:1 1 auto;text-align:left">¬© 2025 PRANAN SHOP. All rights reserved.</div>
  </div>
</footer>

<script src="visitors.js"></script>
<script src="shared-data.js"></script>
<script>
// --- DATA & CONFIG ---
let products = [
  {name: 'Xiaomi Redmi Note 14 Pro', category: 'mobile'},
  {name: 'Samsung Galaxy S25+', category: 'mobile'},
  {name: 'iPhone 15', category: 'mobile'},
  {name: 'ASUS Vivobook', category: 'computer'},
  {name: 'HP Pavilion', category: 'computer'},
  {name: 'Lenovo ThinkPad', category: 'computer'},
  {name: 'Acer Nitro 5', category: 'gaming'},
  {name: 'MacBook Air M2', category: 'computer'},
  {name: 'iPad Gen 10', category: 'mobile'},
  {name: 'Samsung Tab S9', category: 'mobile'},
  {name: 'Logitech Mouse', category: 'accessories'},
  {name: 'Mechanical Keyboard', category: 'accessories'},
  {name: 'Gaming Headset', category: 'audio'},
  {name: 'SSD 1TB', category: 'storage'},
  {name: 'Power Bank', category: 'accessories'},
  {name: 'Smart Watch', category: 'mobile'},
  {name: 'Router WiFi 6', category: 'accessories'},
  {name: 'Bluetooth Speaker', category: 'audio'},
  {name: 'Webcam HD', category: 'camera'},
  {name: 'Monitor 27"', category: 'monitor'}
];

// Load from LocalStorage if available
const savedProducts = localStorage.getItem('pranan_products_data');
if (savedProducts) {
  try {
    const parsed = JSON.parse(savedProducts);
    if (Array.isArray(parsed) && parsed.length > 0) {
      products = parsed;
    }
  } catch(e) {
    console.error('Error loading products from localStorage', e);
  }
}

const categoryNames = {
  'all': '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
  'computer': '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå',
  'case': '‡πÄ‡∏Ñ‡∏™ (Case)',
  'notebook': '‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ',
  'storage': '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
  'mobile': '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠',
  'accessories': '‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏≤‡∏™‡πå',
  'monitor': '‡∏à‡∏≠‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå',
  'audio': '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á',
  'gaming': '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á',
  'camera': '‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û'
};

const localImg = {
  'xiaomi redmi note 14 pro': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 200714.png',
  'redmi': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 200714.png',
  'samsung galaxy': 'imgs/ha0B3NcRT7rU2wIh9SL7.webp',
  's25': 'imgs/ha0B3NcRT7rU2wIh9SL7.webp',
  'samsung tab': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141052.png',
  'iphone': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 195930.png',
  'ipad': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 140926.png',
  'asus vivobook': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-Asus-Vivobook-16-X1605VA-MB549WF.jpg',
  'vivobook go': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-Asus-Vivobook-Go-15-X1504GA-NJ322W.jpg',
  'vivobook': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-Asus-Vivobook-16-X1605VA-MB549WF.jpg',
  'vivobook go': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-Asus-Vivobook-Go-15-X1504GA-NJ322W.jpg',
  'hp pavilion': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-HP-VICTUS-15-fb2094AX.jpg',
  'hp victus': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-HP-VICTUS-15-fb2094AX.jpg',
  'lenovo thinkpad': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-Lenovo-Ideapad-Slim-3-15AMN8-82XQ00C2TA.jpg',
  'lenovo ideapad': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-Lenovo-Ideapad-Slim-3-15AMN8-82XQ00C2TA.jpg',
  'acer nitro': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 140226.png',
  'nitro 5': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 140226.png',
  'gigabyte': 'imgs/‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ-‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡πÑ‡∏´‡∏ô‡∏î‡∏µ-GIGABYTE-G6-MF-H2TH853KH.jpg',
  'macbook': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 140521.png',
  'logitech': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141356.png',
  'mouse': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141356.png',
  'keyboard': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141508.png',
  'mechanical keyboard': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141508.png',
  'headset': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141725.png',
  'gaming headset': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141725.png',
  'ssd': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 141920.png',
  'power bank': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 142305.png',
  'smart watch': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 142649.png',
  'watch': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 142649.png',
  'router': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 143658.png',
  'wifi': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 143658.png',
  'speaker': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 143827.png',
  'bluetooth speaker': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 143827.png',
  'webcam': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 143933.png',
  'monitor': 'imgs/‡∏™‡∏Å‡∏£‡∏µ‡∏ô‡∏ä‡πá‡∏≠‡∏ï 2025-12-28 144113.png'
};

const searchTerms = {
  'Xiaomi Redmi Note 14 Pro': 'xiaomi smartphone',
  'Samsung Galaxy S25+': 'samsung smartphone',
  'iPhone 15': 'iphone',
  'ASUS Vivobook': 'asus laptop',
  'HP Pavilion': 'hp laptop',
  'Lenovo ThinkPad': 'lenovo laptop',
  'Acer Nitro 5': 'gaming laptop',
  'MacBook Air M2': 'macbook',
  'iPad Gen 10': 'ipad',
  'Samsung Tab S9': 'tablet',
  'Logitech Mouse': 'computer mouse',
  'Mechanical Keyboard': 'mechanical keyboard',
  'Gaming Headset': 'gaming headset',
  'SSD 1TB': 'ssd hard drive',
  'Power Bank': 'power bank',
  'Smart Watch': 'smartwatch',
  'Router WiFi 6': 'wifi router',
  'Bluetooth Speaker': 'bluetooth speaker',
  'Webcam HD': 'webcam',
  'Monitor 27"': 'computer monitor'
};

let currentCategory = 'all';

// --- CORE FUNCTIONS ---

// Cart Management
let cart = [];

// --- SERVER CART SYNC ---
async function syncCartToServer() {
  const user = localStorage.getItem('logged_in_user');
  if (!user) return; // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á sync ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login

  try {
    await fetch('http://localhost:3000/cart', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: user, cart: cart })
    });
    console.log('‚úÖ Cart synced to server');
  } catch (err) {
    console.error('‚ùå Error syncing cart:', err);
  }
}

async function loadCartFromServer() {
  const user = localStorage.getItem('logged_in_user');
  if (!user) return;

  try {
    const res = await fetch(`http://localhost:3000/cart/${encodeURIComponent(user)}`);
    if (res.ok) {
      const data = await res.json();
      if (Array.isArray(data.cart)) {
        cart = data.cart;
        updateCartUI(); // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        console.log('‚úÖ Cart loaded from server');
      }
    }
  } catch (err) {
    console.error('‚ùå Error loading cart:', err);
  }
}

function addToCart(name, price, img) {
  // Check if item already exists
  const existingItem = cart.find(item => item.name === name);
  
  if(existingItem) {
    existingItem.quantity++;
  } else {
    cart.push({ name, price, img, quantity: 1 });
  }
  
  updateCartUI();
  syncCartToServer();
}

function removeFromCart(index) {
  cart.splice(index, 1);
  updateCartUI();
  syncCartToServer();
}

function updateCartQuantity(index, change) {
  cart[index].quantity += change;
  if(cart[index].quantity <= 0) {
    removeFromCart(index);
  } else {
    updateCartUI();
    syncCartToServer();
  }
}

function updateCartUI() {
  const cartItemsDiv = document.getElementById('cartItems');
  const cartCountSpan = document.querySelector('.cart span');
  const cartTotalSpan = document.getElementById('cartTotal');
  const cartItemCountSpan = document.getElementById('cartItemCount');
  
  // Update cart count
  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  cartCountSpan.textContent = totalItems;
  
  // Update item count in footer
  if(cartItemCountSpan) {
    cartItemCountSpan.textContent = `${cart.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${totalItems} ‡∏ä‡∏¥‡πâ‡∏ô)`;
  }
  
  // Show/hide cart count badge
  if(totalItems > 0) {
    cartCountSpan.style.display = 'block';
  } else {
    cartCountSpan.style.display = 'none';
  }
  
  // Update cart total
  const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  cartTotalSpan.textContent = formatPrice(totalPrice);
  
  // Update cart items display
  if(cart.length === 0) {
    cartItemsDiv.innerHTML = `
      <div class="cart-empty">
        <div class="cart-empty-icon">üõí</div>
        <p style="font-size:20px;font-weight:600;margin:12px 0;color:#666;">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>
        <p style="font-size:14px;color:#999;line-height:1.5;">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
        <button onclick="closeCartModal()" style="margin-top:18px;background:#d50000;color:#fff;border:none;padding:10px 24px;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;box-shadow:0 2px 8px rgba(213,0,0,0.2);transition:all 0.3s;">üõçÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</button>
      </div>
    `;
  } else {
    cartItemsDiv.innerHTML = cart.map((item, index) => {
      const itemSubtotal = item.price * item.quantity;
      return `
      <div class="cart-item">
        <img src="${item.img}" alt="${item.name}">
        <div class="cart-item-info">
          <div class="cart-item-name">${item.name}</div>
          <div class="cart-item-price">‡∏£‡∏≤‡∏Ñ‡∏≤ ${formatPrice(item.price)} / ‡∏ä‡∏¥‡πâ‡∏ô</div>
          <div class="cart-item-subtotal">‡∏£‡∏ß‡∏° ${formatPrice(itemSubtotal)}</div>
        </div>
        <div class="cart-item-controls">
          <div class="cart-qty-group">
            <button class="cart-qty-btn" onclick="updateCartQuantity(${index}, -1)" title="‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">‚àí</button>
            <div class="cart-qty">${item.quantity}</div>
            <button class="cart-qty-btn" onclick="updateCartQuantity(${index}, 1)" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">+</button>
          </div>
        </div>
        <button class="cart-remove-btn" onclick="removeFromCart(${index})" title="‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">√ó</button>
      </div>
    `;}).join('');
  }
}

// 1. Switch Pages (Router)
function switchPage(pageId, keepCategory = false) {
    if (pageId === 'manage' || pageId === 'stock') {
        const isAdmin = localStorage.getItem('is_admin') === 'true';
        if (!isAdmin) {
            // alert('‚ö†Ô∏è ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
            return;
        }
    }

    const homeView = document.getElementById('view-home');
    const manageView = document.getElementById('view-manage');
    const stockView = document.getElementById('view-stock');
    const contactView = document.getElementById('view-contact');
    const productDetailView = document.getElementById('view-product-detail');
    
    // Hide all
    homeView.style.display = 'none';
    manageView.style.display = 'none';
    stockView.style.display = 'none';
    contactView.style.display = 'none';
    if(productDetailView) productDetailView.style.display = 'none';
    
    // Show requested
    if(pageId === 'home') {
        homeView.style.display = 'block';
        // Reset category to 'all' ONLY when not keeping category (e.g. clicking 'Home' menu)
        // If coming from filterByCategory, keepCategory will be true
        if (!keepCategory) {
            currentCategory = 'all';
             setTimeout(() => { updateSectionTitle(); }, 50); 
        }
        renderProducts(); 
    } else if (pageId === 'manage') {
        manageView.style.display = 'block';
    } else if (pageId === 'stock') {
        stockView.style.display = 'block';
        renderStockTable(); // Render stock data
    } else if (pageId === 'contact') {
        contactView.style.display = 'block';
    } else if (pageId === 'product-detail') {
        if(productDetailView) productDetailView.style.display = 'block';
    }
    
    // Scroll top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Check for scroll request on load
document.addEventListener('DOMContentLoaded', () => {
  // Update Menu UI based on Admin Status
  const isAdmin = localStorage.getItem('is_admin') === 'true';
  const manageLink = document.getElementById('nav-manage');
  const stockLink = document.getElementById('nav-stock');
  
  if (!isAdmin) {
      if(manageLink) {
          // manageLink.style.pointerEvents = 'none'; 
          manageLink.style.opacity = '0.5'; 
          manageLink.title = '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô';
      }
      if(stockLink) {
          // stockLink.style.pointerEvents = 'none'; 
          stockLink.style.opacity = '0.5'; 
          stockLink.title = '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô';
      }
  }

  if(localStorage.getItem('scroll_to_products') === 'true'){
    localStorage.removeItem('scroll_to_products');
    setTimeout(() => {
      const productSection = document.getElementById('productSectionTitle');
      if(productSection){
        productSection.scrollIntoView({ behavior: 'smooth' });
      }
    }, 500);
  }
});

// 2. Image Helpers
function findLocal(name){
  const lower = name.toLowerCase();
  for(const k in localImg){ if(lower.includes(k)) return localImg[k]; }
  return null;
}

function unsplashFor(name){
  const term = searchTerms[name] || name.split(' ')[0];
  return `https://source.unsplash.com/400x300/?${encodeURIComponent(term)}`;
}

// Handle file selection and preview
function handleFileSelect(event) {
    const file = event.target.files[0];
    if(!file) return;
    
    // Check if file is an image
    if(!file.type.startsWith('image/')) {
        alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
        event.target.value = '';
        return;
    }
    
    // Resize Image Logic
    const reader = new FileReader();
    reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
            // Setup Canvas
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            const MAX_WIDTH = 800;
            const MAX_HEIGHT = 800;

            // Calculate new dimensions
            if (width > height) {
                if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }
            } else {
                if (height > MAX_HEIGHT) {
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                }
            }
            
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            // Compress to JPEG 0.7
            const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
            
            // Set Preview
            const preview = document.getElementById('imgPreview');
            preview.innerHTML = `<img src="${dataUrl}" style="width:100%;height:100%;object-fit:contain;">`;
            
            // Clear URL input
            document.getElementById('product_image').value = '';
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

// Update preview from URL
function updatePreviewFromURL(url) {
    const preview = document.getElementById('imgPreview');
    if(url && url.length > 5) {
        preview.innerHTML = `<img src="${url}" onerror="this.onerror=null;this.parentElement.innerHTML='<span>‚ùå ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span>'">`;  
        // Clear file input when URL is entered
        document.getElementById('product_image_file').value = '';
    } else {
        preview.innerHTML = `<span>‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span>`;
    }
}

// Keep old function for compatibility
function updatePreview(url) {
    updatePreviewFromURL(url);
}

// 3. Render Products
function formatPrice(n){ return '‡∏ø' + Number(n).toLocaleString('th-TH'); }

// Stock Data with quantities and prices
let stockData = [
  {name: 'Xiaomi Redmi Note 14 Pro', category: 'mobile', stock: 45, price: 9990},
  {name: 'Samsung Galaxy S25+', category: 'mobile', stock: 8, price: 34900},
  {name: 'iPhone 15', category: 'mobile', stock: 3, price: 29900},
  {name: 'ASUS Vivobook', category: 'computer', stock: 15, price: 16990},
  {name: 'HP Pavilion', category: 'computer', stock: 12, price: 19990},
  {name: 'Lenovo ThinkPad', category: 'computer', stock: 0, price: 32990},
  {name: 'Acer Nitro 5', category: 'gaming', stock: 7, price: 26990},
  {name: 'MacBook Air M2', category: 'computer', stock: 5, price: 39900},
  {name: 'iPad Gen 10', category: 'mobile', stock: 20, price: 12900},
  {name: 'Samsung Tab S9', category: 'mobile', stock: 18, price: 23900},
  {name: 'Logitech Mouse', category: 'accessories', stock: 150, price: 890},
  {name: 'Mechanical Keyboard', category: 'accessories', stock: 85, price: 1890},
  {name: 'Gaming Headset', category: 'audio', stock: 42, price: 1590},
  {name: 'SSD 1TB', category: 'storage', stock: 95, price: 2290},
  {name: 'Power Bank', category: 'accessories', stock: 0, price: 990},
  {name: 'Smart Watch', category: 'mobile', stock: 25, price: 3990},
  {name: 'Router WiFi 6', category: 'accessories', stock: 30, price: 2490},
  {name: 'Bluetooth Speaker', category: 'audio', stock: 60, price: 1290},
  {name: 'Webcam HD', category: 'camera', stock: 35, price: 990},
  {name: 'Monitor 27"', category: 'monitor', stock: 2, price: 5990}
];

// Load from LocalStorage if available
const savedStock = localStorage.getItem('pranan_stock_data');
if (savedStock) {
  try {
    const parsed = JSON.parse(savedStock);
    if (Array.isArray(parsed) && parsed.length > 0) {
      stockData = parsed;
    }
  } catch(e) {
    console.error('Error loading stockData from localStorage', e);
  }
}

// Render Stock Table
function renderStockTable() {
  const tbody = document.getElementById('stock-table-body');
  if(!tbody) return;
  
  let totalProducts = stockData.length;
  let inStock = 0;
  let lowStock = 0;
  let outStock = 0;
  
  const html = stockData.map((item, index) => {
    let statusBadge = '';
    let statusClass = '';
    
    if(item.stock === 0) {
      statusBadge = '<span class="stock-badge stock-out">‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</span>';
      statusClass = 'stock-out';
      outStock++;
    } else if(item.stock <= 5) {
      statusBadge = '<span class="stock-badge stock-low">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</span>';
      statusClass = 'stock-low';
      lowStock++;
    } else if(item.stock <= 20) {
      statusBadge = '<span class="stock-badge stock-medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</span>';
      statusClass = 'stock-medium';
      inStock++;
    } else {
      statusBadge = '<span class="stock-badge stock-high">‡∏°‡∏µ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</span>';
      statusClass = 'stock-high';
      inStock++;
    }
    
    // Try to get image from products array if indices match, or from item itself
    let imgSrc = null;
    if (products[index] && products[index].image) {
        imgSrc = products[index].image;
    } else if (item.image) {
        imgSrc = item.image;
    } else {
        imgSrc = findLocal(item.name) || unsplashFor(item.name);
    }

    const categoryLabel = categoryNames[item.category] || item.category;
    const totalValue = item.stock * item.price;
    
    return `
      <tr>
        <td>${index + 1}</td>
        <td><img src="${imgSrc}" style="width:50px;height:50px;object-fit:cover;border-radius:8px;" onerror="this.src='https://via.placeholder.com/50'"></td>
        <td><strong>${item.name}</strong></td>
        <td>${categoryLabel}</td>
        <td style="text-align:center;font-weight:bold;font-size:16px;">${item.stock}</td>
        <td>${statusBadge}</td>
        <td>${formatPrice(item.price)}</td>
        <td><strong>${formatPrice(totalValue)}</strong></td>
        <td style="text-align:center; white-space: nowrap;">
          <div style="display: inline-flex; gap: 5px; justify-content: center;">
            <button onclick="editProduct(${index})" style="background:#4CAF50;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:14px;transition:all 0.3s;" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‚úèÔ∏è</button>
            <button onclick="deleteProduct(${index})" style="background:#f44336;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:14px;transition:all 0.3s;" title="‡∏•‡∏ö">üóëÔ∏è</button>
          </div>
        </td>
      </tr>
    `;
  }).join('');
  
  tbody.innerHTML = html;
  
  // Update stats
  document.getElementById('total-products').textContent = totalProducts;
  document.getElementById('in-stock').textContent = inStock;
  document.getElementById('low-stock').textContent = lowStock;
  document.getElementById('out-stock').textContent = outStock;
}

function renderProducts(searchFilter){
  const q = String(searchFilter || '').trim().toLowerCase();
  
  // 1. If NO search filter and Category IS 'all' -> Render HOME LAYOUT (Multiple Categories)
  if(!q && currentCategory === 'all') {
      const container = document.querySelector('.products');
      container.style.display = 'block'; // Block mode for sections
      container.innerHTML = '';
      
      const categoriesToShow = [
          {id: 'recommended', name: 'üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'},
          {id: 'notebook', name: ' ‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ (Notebook)'},
          {id: 'mobile', name: ' ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠'},
          {id: 'gaming', name: ' ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á'},
          {id: 'accessories', name: ' ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°'},
          {id: 'computer', name: ' ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'},
          {id: 'case', name: ' ‡πÄ‡∏Ñ‡∏™‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå'},
          {id: 'storage', name: ' ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'},
          {id: 'monitor', name: ' ‡∏à‡∏≠‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå'},
          {id: 'audio', name: ' ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á'},
          {id: 'camera', name: ' ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û'}
      ];

      let fullHtml = '';

      categoriesToShow.forEach(cat => {
           let catProducts = [];
           
           if(cat.id === 'recommended') {
               // Recommended: Pick random 10 or specified
               catProducts = products.slice(0, 10); // Just take first 10 for now
           } else {
               // Filter by category
               catProducts = products.filter(p => p.category === cat.id).slice(0, 6); // Take max 6 per category
           }

           if(catProducts.length > 0) {
               fullHtml += `
                 <div class="category-section" style="margin-bottom: 40px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #f0f0f0;">
                        <h2 style="font-size:24px;color:#333;margin:0;display:flex;align-items:center;gap:10px;">
                             ${cat.name}
                        </h2>
                        ${cat.id !== 'recommended' ? `<a href="#" onclick="filterByCategory(event, '${cat.id}')" style="color:#d50000;text-decoration:none;font-weight:600;font-size:14px;display:flex;align-items:center;transition:all 0.2s;">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span style="font-size:12px;margin-left:5px;">‚ñ∂</span></a>` : ''}
                    </div>
                    
                    <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(220px, 1fr));gap:20px;">
                        ${catProducts.map(p => generateProductCard(p)).join('')}
                    </div>
                 </div>
               `;
           }
      });
      
      container.innerHTML = fullHtml;
      
      // Update Title to generic
      const titleEl = document.querySelector('.section-title');
      if(titleEl) titleEl.style.display = 'none'; // Hide default section title in this mode

      return;
  }
  
  // 2. Normal Mode (Filter or Search) -> Use Default Grid
  const container = document.querySelector('.products');
  container.style.display = 'grid'; // Grid mode
  
  // Update Title
  const titleEl = document.querySelector('.section-title');
  if(titleEl) {
      titleEl.style.display = 'block';
  }
  updateSectionTitle();

  let list = products;
  
  // Filter Category
  if(currentCategory !== 'all'){
    list = list.filter(p => p.category === currentCategory);
  }
  
  // Filter Search
  if(q){
    const terms = q.split(' ').filter(k => k.trim() !== '');
    
    // Mapping ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á ‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
    const categoryAliases = {
        'notebook': 'laptop ‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ notebook ‡πÅ‡∏•‡πá‡∏õ‡∏ó‡πá‡∏≠‡∏õ not nb',
        'gaming': 'game ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á gaming gam',
        'computer': 'pc desktop ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏ï‡πä‡∏∞ personal computer com',
        'mobile': 'phone ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ mob tel',
        'monitor': 'screen display led lcd ‡∏à‡∏≠ ‡∏à‡∏≠‡∏Ñ‡∏≠‡∏° ‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå mon',
        'accessories': 'gear device gadget keyboard mouse ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î ‡πÄ‡∏°‡∏≤‡∏™‡πå ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏° gadget acc',
        'storage': 'disk drive memory hdd ssd flash drive ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Æ‡∏≤‡∏£‡πå‡∏î‡∏î‡∏¥‡∏™‡∏Å‡πå sto',
        'audio': 'sound speaker headphone earphone microphone ‡∏´‡∏π‡∏ü‡∏±‡∏á ‡∏•‡∏≥‡πÇ‡∏û‡∏á ‡πÑ‡∏°‡∏Ñ‡πå ‡πÄ‡∏™‡∏µ‡∏¢‡∏á audio aud',
        'camera': 'webcam photo video ‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏Ñ‡∏° ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ camera cam',
        'case': 'tower box case ‡πÄ‡∏Ñ‡∏™ ‡πÄ‡∏Ñ‡∏™‡∏Ñ‡∏≠‡∏° ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏° cas',
        'all': ''
    };

    // Mapping ‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Brand Aliases) ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
    const brandAliases = {
        'apple': '‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏• apple ‡πÑ‡∏≠‡πÇ‡∏ü‡∏ô iphone ipad macbook',
        'samsung': '‡∏ã‡∏±‡∏°‡∏ã‡∏∏‡∏á samsung galaxy ‡∏Å‡∏≤‡πÅ‡∏•‡∏Ñ‡∏ã‡∏µ‡πà tab',
        'xiaomi': '‡πÄ‡∏™‡∏µ‡∏¢‡∏ß‡∏´‡∏°‡∏µ‡πà xiaomi redmi ‡πÄ‡∏£‡∏î‡∏°‡∏µ‡πà poco',
        'asus': '‡πÄ‡∏≠‡∏ã‡∏∏‡∏™ asus rog tuf vivobook zenbook',
        'acer': '‡πÄ‡∏≠‡πÄ‡∏ã‡∏≠‡∏£‡πå acer nitro aspire swift predator',
        'lenovo': '‡πÄ‡∏•‡∏≠‡πÇ‡∏ô‡πÇ‡∏ß lenovo thinkpad legion ideapad',
        'hp': '‡πÄ‡∏≠‡∏ä‡∏û‡∏µ hp pavilion omen victus',
        'dell': '‡πÄ‡∏î‡∏•‡∏•‡πå dell inspiron vostro alienware',
        'msi': '‡πÄ‡∏≠‡πá‡∏°‡πÄ‡∏≠‡∏™‡πÑ‡∏≠ msi katana cyborg thin',
        'logitech': '‡πÇ‡∏•‡∏à‡∏¥‡πÄ‡∏ó‡∏Ñ logitech g gaming',
        'sandisk': '‡πÅ‡∏ã‡∏ô‡∏î‡∏¥‡∏™‡∏Å‡πå sandisk',
        'kingston': '‡∏Ñ‡∏¥‡∏á‡∏™‡πå‡∏ï‡∏±‡∏ô kingston',
        'wd': '‡πÄ‡∏ß‡∏™‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô western digital wd',
        'seagate': '‡∏ã‡∏µ‡πÄ‡∏Å‡∏ó seagate',
        'sony': '‡πÇ‡∏ã‡∏ô‡∏µ‡πà sony',
        'canon': '‡πÅ‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏ô canon',
        'intel': '‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏• intel core',
        'amd': '‡πÄ‡∏≠‡πÄ‡∏≠‡πá‡∏°‡∏î‡∏µ amd ryzen'
    };

    // Mapping ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (Product Specific Aliases)
    const productAliases = {
        'redmi': 'redmi ‡πÄ‡∏£‡∏î‡∏°‡∏µ‡πà xiaomi ‡πÄ‡∏™‡∏µ‡∏¢‡∏ß‡∏´‡∏°‡∏µ‡πà',
        'galaxy': 'galaxy ‡∏Å‡∏≤‡πÅ‡∏•‡∏Ñ‡∏ã‡∏µ‡πà samsung ‡∏ã‡∏±‡∏°‡∏ã‡∏∏‡∏á',
        'iphone': 'iphone ‡πÑ‡∏≠‡πÇ‡∏ü‡∏ô apple ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏• ios',
        'ipad': 'ipad ‡πÑ‡∏≠‡πÅ‡∏û‡∏î tablet ‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï apple',
        'macbook': 'macbook ‡πÅ‡∏°‡∏Ñ‡∏ö‡∏∏‡πä‡∏Ñ laptop ‡πÇ‡∏ô‡πä‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ apple',
        'vivobook': 'vivobook ‡∏ß‡∏µ‡πÇ‡∏ß‡πà‡∏ö‡∏∏‡πä‡∏Ñ asus ‡πÄ‡∏≠‡∏ã‡∏∏‡∏™',
        'pavilion': 'pavilion ‡∏û‡∏≤‡∏ß‡∏¥‡πÄ‡∏•‡∏µ‡∏¢‡∏ô hp ‡πÄ‡∏≠‡∏ä‡∏û‡∏µ',
        'thinkpad': 'thinkpad ‡∏ò‡∏¥‡πâ‡∏á‡πÅ‡∏û‡∏î lenovo ‡πÄ‡∏•‡∏≠‡πÇ‡∏ô‡πÇ‡∏ß',
        'nitro': 'nitro ‡πÑ‡∏ô‡πÇ‡∏ï‡∏£ acer ‡πÄ‡∏≠‡πÄ‡∏ã‡∏≠‡∏£‡πå gaming',
        'mouse': 'mouse ‡πÄ‡∏°‡∏≤‡∏™‡πå wireless ‡πÑ‡∏£‡πâ‡∏™‡∏≤‡∏¢ optical',
        'keyboard': 'keyboard ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î mechanical ‡πÄ‡∏°‡∏Ñ‡∏Ñ‡∏≤‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏•',
        'headset': 'headset ‡∏´‡∏π‡∏ü‡∏±‡∏á headphone gaming',
        'ssd': 'ssd ‡πÄ‡∏≠‡∏™‡πÄ‡∏≠‡∏™‡∏î‡∏µ solid state drive storage',
        'power bank': 'powerbank ‡∏û‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏á‡∏Ñ‡πå ‡πÅ‡∏ö‡∏ï‡∏™‡∏≥‡∏£‡∏≠‡∏á',
        'smart watch': 'smartwatch ‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡∏ß‡∏≠‡∏ó‡∏ä‡πå ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ watch sma',
        'ram': 'ram memory ‡πÅ‡∏£‡∏° ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥',
        'router': 'router ‡πÄ‡∏£‡∏≤‡πÄ‡∏ï‡∏≠‡∏£‡πå wifi ‡πÑ‡∏ß‡πÑ‡∏ü internet',
        'speaker': 'speaker ‡∏•‡∏≥‡πÇ‡∏û‡∏á bluetooth ‡∏ö‡∏•‡∏π‡∏ó‡∏π‡∏ò audio',
        'webcam': 'webcam ‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏Ñ‡∏° camera ‡∏Å‡∏•‡πâ‡∏≠‡∏á',
        'monitor': 'monitor ‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏à‡∏≠ screen display'
    };

    list = list.filter(p => {
        // Check fields safely
        const name = p.name || '';
        const catId = p.category || '';
        const catName = categoryNames[p.category] || '';
        const desc = p.description || '';
        const extraKeywords = categoryAliases[catId] || ''; 
        
        const lowerName = name.toLowerCase();

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå
        let brandKeywords = '';
        for(const brand in brandAliases) {
            if(lowerName.includes(brand)) {
                brandKeywords += ' ' + brandAliases[brand];
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏∏‡πà‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        let productKeywords = '';
        for(const key in productAliases) {
            if(lowerName.includes(key)) {
                productKeywords += ' ' + productAliases[key];
            }
        }
        
        // Combine into one searchable string for easier matching
        // ‡∏ï‡∏±‡∏î desc ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡πÅ‡∏£‡∏°)
        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞: ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà + alias ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
        const fullText = (name + ' ' + catId + ' ' + catName + ' ' + extraKeywords + ' ' + brandKeywords + ' ' + productKeywords).toLowerCase();
        
        // Standard Search: All Terms must be present (AND Logic)
        return terms.every(term => fullText.includes(term));
    });
  }
  
  const html = list.map(p => generateProductCard(p)).join('');
  
  if(container) container.innerHTML = html || '<p style="grid-column:1/-1;text-align:center;color:#999;padding:40px">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</p>';
}

function generateProductCard(p) {
    // Logic ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà User ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó (p.image) ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏´‡∏≤ local ‡∏´‡∏£‡∏∑‡∏≠ unsplash
    let src = p.image;
    
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÉ‡∏ô object ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Data URL ‡∏´‡∏£‡∏∑‡∏≠ path
    if(!src) {
        const local = findLocal(p.name);
        const fallback = unsplashFor(p.name);
        src = local || fallback;
    }

    // ‡∏´‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏≤‡∏Å stockData ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
    let stockItem = null;
    if(typeof stockData !== 'undefined' && Array.isArray(stockData)) {
      stockItem = stockData.find(s => s.name === p.name);
    }
    
    let discountedPrice, originalPrice, discountPercent;

    // Logic ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (40% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö 40% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô)
    // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    let nameSum = 0;
    const pName = p.name || "";
    for(let i=0; i<pName.length; i++) nameSum += pName.charCodeAt(i);
    // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÉ‡∏´‡πâ 70% ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
    const isRecommended = (nameSum % 10 < 7); 

    if(isRecommended) {
        discountPercent = 40;
    } else {
        // ‡∏•‡∏î‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö 40% (‡∏™‡∏∏‡πà‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 35-39%)
        const variants = [35, 36, 37, 38, 39];
        discountPercent = variants[nameSum % variants.length];
    }
    
    if(stockItem && stockItem.price) {
      discountedPrice = stockItem.price;
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏•‡∏≠‡∏Å‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ % ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
      // Price = Original * (1 - discount%) => Original = Price / (1 - discount%)
      originalPrice = Math.floor(discountedPrice / (1 - (discountPercent/100)));
    } else {
      originalPrice = Math.floor(Math.random()*30000+3000);
      discountedPrice = Math.floor(originalPrice * (1 - discountPercent/100));
    }
    
    // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏à‡∏≤‡∏Å product ‡∏´‡∏£‡∏∑‡∏≠ default
    const description = p.description || '‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå ‡∏™‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß';
    
    // Convert object to string for onClick handler
    const productDataStr = encodeURIComponent(JSON.stringify(p));
    const finalOriginalPrice = originalPrice;
    const finalDiscountedPrice = discountedPrice;
    const finalDiscountPercent = discountPercent;

    return `
      <div class='card'>
        <div class='img-wrapper' onclick='openProductDetail("${p.name.replace(/'/g, "\\'")}", ${JSON.stringify(p).replace(/'/g, "&#39;")}, ${finalDiscountedPrice}, ${finalOriginalPrice}, ${finalDiscountPercent})' style="cursor:pointer;">
          <img src='${src}' alt='${p.name}' onerror="this.onerror=null;this.src='https://via.placeholder.com/400x300?text=No+Image'" />
          <div class='discount-badge'>-${discountPercent}%</div>
        </div>
        <div class='brand'>PRANAN</div>
        <div class='name' onclick='openProductDetail("${p.name.replace(/'/g, "\\'")}", ${JSON.stringify(p).replace(/'/g, "&#39;")}, ${finalDiscountedPrice}, ${finalOriginalPrice}, ${finalDiscountPercent})' style="cursor:pointer;">${p.name}</div>
        <div class='desc'>${description}</div>
        <div style='margin:10px 0;'>
          <div style='text-decoration:line-through;color:#999;font-size:14px;'>${formatPrice(originalPrice)}</div>
          <div class='price' style='color:#d50000;'>${formatPrice(discountedPrice)}</div>
        </div>
        <button onclick='addToCart("${p.name.replace(/'/g, "\\'")}", ${discountedPrice}, "${src ? src.replace(/'/g, "\\'") : ""}")'>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
      </div>`;
}

// openProductDetail function
function openProductDetail(name, productObj, discountedPrice, originalPrice, discountPercent) {
    if(typeof productObj === 'string') {
        try {
            productObj = JSON.parse(productObj);
        } catch(e) {
            console.error("Error parsing product object", e);
            productObj = { name: name };
        }
    }

    const content = document.getElementById('product-detail-page-content');
    
    // Find image
    let src = productObj.image;
    if(!src) {
        const local = findLocal(name);
        const fallback = unsplashFor(name);
        src = local || fallback;
    }
    
    // Mock Specs based on Category
    const category = productObj.category || 'general';
    let specsHtml = '';
    
    // Define specs based on category
    const commonSpecs = `
        <tr><th>Brand</th><td>PRANAN Selection</td></tr>
        <tr><th>Warranty</th><td>1 Year</td></tr>
        <tr><th>Lighting</th><td>RGB (Available on some models)</td></tr>
    `;
    
    if(category === 'accessories' || name.toLowerCase().includes('keyboard')) {
        specsHtml = `
            <tr><th>Brand</th><td>KZKI / PRANAN</td></tr>
            <tr><th>Switch Name</th><td>ETERNITY TACTILE SWITCH</td></tr>
            <tr><th>Connectivity</th><td>WIRELESS / BLUETOOTH / WIRED</td></tr>
            <tr><th>Lighting</th><td>RGB</td></tr>
            <tr><th>Localization</th><td>EN/TH</td></tr>
            <tr><th>Wireless Frequency</th><td>2.4Ghz</td></tr>
            <tr><th>Battery</th><td>3750mAh</td></tr>
            <tr><th>Dimension</th><td>335.8 x 55.5 x 41.5 mm.</td></tr>
            <tr><th>Weight</th><td>1 kg.</td></tr>
            <tr><th>USB Port</th><td>USB Type C</td></tr>
            <tr><th>Type</th><td>MECHANICAL KEYBOARD</td></tr>
        `;
    } else if (category === 'mobile' || category === 'notebook' || category === 'computer') {
        specsHtml = `
            <tr><th>Brand</th><td>${name.split(' ')[0]}</td></tr>
            <tr><th>Model</th><td>${name}</td></tr>
            <tr><th>Processor</th><td>High Performance CPU</td></tr>
            <tr><th>Memory (RAM)</th><td>8GB / 16GB</td></tr>
            <tr><th>Storage</th><td>256GB / 512GB SSD</td></tr>
            <tr><th>Display</th><td>High Resolution Screen</td></tr>
            <tr><th>OS</th><td>Latest OS</td></tr>
            <tr><th>Warranty</th><td>1 Year Official</td></tr>
        `;
    } else {
        specsHtml = `
            <tr><th>Brand</th><td>Generic / PRANAN</td></tr>
            <tr><th>Model</th><td>${name}</td></tr>
            <tr><th>Type</th><td>${category}</td></tr>
            <tr><th>Material</th><td>High Quality Material</td></tr>
            <tr><th>Feature</th><td>Durable & Long Lasting</td></tr>
            <tr><th>Warranty</th><td>1 Year</td></tr>
        `;
    }

    // Generate Rich Description
    let longDescription = productObj.description;
    if (!longDescription) {
        if (category === 'accessories' || name.toLowerCase().includes('keyboard') || name.toLowerCase().includes('mouse') || name.toLowerCase().includes('headset')) {
            longDescription = `
                <strong>${name}</strong> - ‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏à‡∏≤‡∏Å PRANAN SHOP ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏û‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏ï‡∏£‡∏µ‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ <br><br>
                ‚ú® <strong>‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:</strong><br>
                ‚Ä¢ <strong>Performance & Precision:</strong> ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏î (Anti-Ghosting 100%) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏∏‡∏Å‡∏ä‡πá‡∏≠‡∏ï‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç<br>
                ‚Ä¢ <strong>Durability:</strong> ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏Å‡∏£‡∏î‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏¥‡∏ö‡∏•‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å<br>
                ‚Ä¢ <strong>Ergonomic Design:</strong> ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏£‡∏µ‡∏£‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏•‡πâ‡∏≤‡πÅ‡∏°‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô<br>
                ‚Ä¢ <strong>RGB Lighting:</strong> ‡πÑ‡∏ü RGB 16.8 ‡∏•‡πâ‡∏≤‡∏ô‡∏™‡∏µ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏ü‡πÑ‡∏î‡πâ‡∏≠‡∏¥‡∏™‡∏£‡∏∞ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà‡πÉ‡∏´‡πâ‡πÇ‡∏ï‡πä‡∏∞‡∏Ñ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br><br>
                ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÑ‡∏ó‡∏¢ 1 ‡∏õ‡∏µ‡πÄ‡∏ï‡πá‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏≤‡∏á‡πÉ‡∏à‡πÑ‡∏î‡πâ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!
            `;
        } else if (category === 'notebook' || category === 'computer') {
            longDescription = `
                <strong>${name}</strong> - ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏´‡πà‡∏á‡∏Ç‡∏∏‡∏°‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏•‡πá‡∏õ‡∏ó‡πá‡∏≠‡∏õ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏à‡∏¥‡∏ô‡∏ï‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö AAA ‡∏Å‡πá‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏∞‡∏î‡∏∏‡∏î <br><br>
                üöÄ <strong>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏î‡πà‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡πá‡∏≠‡∏õ:</strong><br>
                ‚Ä¢ <strong>Powerful Processing:</strong> ‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ CPU ‡∏£‡∏∏‡πà‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏à‡∏≠‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏ö‡∏≤‡∏¢<br>
                ‚Ä¢ <strong>Stunning Display:</strong> ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á ‡∏Ç‡∏≠‡∏ö‡∏à‡∏≠‡∏ö‡∏≤‡∏á ‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á (sRGB 100%) ‡∏û‡∏£‡πâ‡∏≠‡∏° Refresh Rate ‡∏™‡∏π‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•<br>
                ‚Ä¢ <strong>Advanced Cooling:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°<br>
                ‚Ä¢ <strong>Connectivity:</strong> ‡∏û‡∏≠‡∏£‡πå‡∏ï‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á USB-C, HDMI ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Wi-Fi 6 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î<br><br>
                ‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏° Windows ‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏ó‡πâ ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå On-site Service ‡∏≠‡∏∏‡πà‡∏ô‡πÉ‡∏à‡∏ï‡∏•‡∏≠‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            `;
        } else if (category === 'mobile' || category === 'tablet') {
             longDescription = `
                <strong>${name}</strong> - ‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡πÇ‡∏ü‡∏ô‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏•‡πâ‡∏≥‡∏™‡∏°‡∏±‡∏¢‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì ‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏∏‡∏Å‡πÑ‡∏•‡∏ü‡πå‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÉ‡∏ô‡∏¢‡∏∏‡∏Ñ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• <br><br>
                üì± <strong>‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∏‡πà‡∏ô‡∏ô‡∏µ‡πâ?</strong><br>
                ‚Ä¢ <strong>Pro-Grade Camera:</strong> ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á ‡∏ñ‡πà‡∏≤‡∏¢‡∏™‡∏ß‡∏¢‡πÅ‡∏°‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏° AI Beauty<br>
                ‚Ä¢ <strong>Immersive Screen:</strong> ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Å‡∏ß‡πâ‡∏≤‡∏á ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏°‡∏ä‡∏±‡∏î ‡∏™‡∏π‡πâ‡πÅ‡∏™‡∏á‡πÅ‡∏î‡∏î‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏•‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏¥‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏≤<br>
                ‚Ä¢ <strong>All-Day Battery:</strong> ‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡∏™‡∏π‡∏á ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏≤‡∏£‡πå‡∏à‡πÄ‡∏£‡πá‡∏ß (Fast Charging)<br>
                ‚Ä¢ <strong>Smooth Performance:</strong> ‡∏ä‡∏¥‡∏õ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏£‡∏á ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•<br><br>
                ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÅ‡∏ó‡πâ 100% ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÑ‡∏ó‡∏¢‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
            `;
        } else {
            longDescription = `
                <strong>${name}</strong> - ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô PRANAN SHOP ‡∏Ñ‡∏±‡∏î‡∏™‡∏£‡∏£‡∏°‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì <br><br>
                ‚úÖ <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong><br>
                ‚Ä¢ ‡∏ú‡∏•‡∏¥‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô<br>
                ‚Ä¢ ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏á‡∏ï‡∏±‡∏ß<br>
                ‚Ä¢ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (QC Pass) ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏°‡∏∑‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô<br>
                ‚Ä¢ ‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡πà‡∏ô‡∏´‡∏ô‡∏≤ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á<br><br>
                ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô Admin ‡∏Ñ‡∏≠‡∏¢‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏°. ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à
            `;
        }
    }

    // Page HTML Structure
    const html = `
        <div style="margin-bottom: 20px;">
            <button onclick="switchPage('home', true)" style="background:none; border:none; color:#666; font-size:16px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:5px; padding:0;">
                ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
            </button>
        </div>
        <div class="product-detail-container">
            <div class="product-detail-img">
                <img src="${src}" alt="${name}">
            </div>
            <div class="product-detail-info">
                <div class="product-detail-brand">
                    <span>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå: ${name.split(' ')[0]}</span>
                    <div style="flex:1"></div>
                    <div class="product-detail-buttons">
                         <a href="https://www.facebook.com/share/1Mb36LsGdx/" target="_blank" class="share-btn" style="text-decoration:none;">f</a>
                         <a href="https://www.tiktok.com/@pranan69?_r=1&_t=ZS-93ESNLm9Yyj" target="_blank" class="share-btn" style="text-decoration:none;">t</a>
                    </div>
                </div>
                
                <h1 class="product-detail-title">${name} (${categoryNames[category] || category})</h1>
                
                <div class="product-detail-price">
                    ${formatPrice(discountedPrice)}
                    <span class="product-detail-old-price">${formatPrice(originalPrice)}</span>
                </div>
                
                <div class="product-actions-row">
                    <div class="qty-selector">
                        <button class="qty-btn" onclick="adjustDetailQty(-1)">-</button>
                        <input type="text" class="qty-input" value="01" id="detailQty" readonly>
                        <button class="qty-btn" onclick="adjustDetailQty(1)">+</button>
                    </div>
                </div>
                
                <div class="product-actions-row" style="margin-top:0;">
                    <button class="btn-add-cart" onclick="addToCartFromDetail('${name.replace(/'/g, "\\'")}', ${discountedPrice}, '${src ? src.replace(/'/g, "\\'") : ""}')">
                        üõçÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                    </button>
                    <button class="btn-buy-now" onclick="buyNowFromDetail('${name.replace(/'/g, "\\'")}', ${discountedPrice}, '${src ? src.replace(/'/g, "\\'") : ""}')">
                        ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢
                    </button>
                </div>
                
                <div style="margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
                   <h3 style="color:#333; font-size:18px; margin-bottom:10px;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                   <p style="color:#555; font-size:14px; line-height:1.6;">
                       ${longDescription}
                   </p>
                </div>
            </div>
        </div>
        
        <div class="spec-container">
             <div class="spec-header">
                <svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M16,18H8V16H16V18M16,14H8V12H16V14M13,9V3.5L18.5,9H13Z"/></svg>
                <h3>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
             </div>
             <table class="spec-table">
                <tbody>
                   ${specsHtml}
                </tbody>
             </table>
        </div>
    `;
    
    content.innerHTML = html;
    switchPage('product-detail');
}

function adjustDetailQty(delta) {
    const input = document.getElementById('detailQty');
    let val = parseInt(input.value);
    val += delta;
    if(val < 1) val = 1;
    input.value = val < 10 ? '0' + val : val;
}

function addToCart(name, price, img) {
    const currentUser = localStorage.getItem('logged_in_user');
    if (!currentUser) {
        openLoginModal();
        return;
    }

    const existingItem = cart.find(item => item.name === name);
    if(existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({ name, price, img: img, quantity: 1 });
    }
    updateCartUI();
    syncCartToServer();
}

function addToCartFromDetail(name, price, img) {
    const currentUser = localStorage.getItem('logged_in_user');
    if (!currentUser) {
        openLoginModal();
        return;
    }

    const qty = parseInt(document.getElementById('detailQty').value);
    
    // Check if item already exists
    const existingItem = cart.find(item => item.name === name);
  
    if(existingItem) {
        existingItem.quantity += qty;
    } else {
        cart.push({ name, price, img: img, quantity: qty });
    }
    
    updateCartUI();
    syncCartToServer();
}

function buyNowFromDetail(name, price, img) {
    const currentUser = localStorage.getItem('logged_in_user');
    if (!currentUser) {
        openLoginModal();
        return;
    }

    const qty = parseInt(document.getElementById('detailQty').value);
    
    // Direct Checkout - Do NOT add to global cart logic here
    const item = [{ name, price, img: img, quantity: qty }];

    // Open checkout explicitly with this item
    checkout(item);
    
    // Note: We do NOT close productDetailModal here to keep user context "on page"
    // document.getElementById('productDetailModal').classList.remove('show');
}

// 4. Interaction Handlers
function filterByCategory(event, category){
  event.preventDefault();
  currentCategory = category;
  
  // Ensure we are on home page, but tell switchPage to KEEP the category we just set
  switchPage('home', true);
  
  // Close dropdown
  const dropdown = document.getElementById('categoryDropdown');
  if(dropdown) dropdown.classList.remove('active');
  
  // Scroll to products
  setTimeout(() => {
    document.querySelector('.section-title').scrollIntoView({ behavior: 'smooth' });
  }, 100);
}

function updateSectionTitle(){
  const titleEl = document.querySelector('.section-title');
  if(titleEl){
    const categoryName = categoryNames[currentCategory] || '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥';
    titleEl.textContent = currentCategory === 'all' ? '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥' : categoryName;
  }
}

function toggleDropdown(event){
  event.stopPropagation();
  const dropdown = document.getElementById('categoryDropdown');
  dropdown.classList.toggle('active');
}

// Close dropdown on click outside
document.addEventListener('click', function(e){
  const dropdown = document.getElementById('categoryDropdown');
  if(dropdown && !dropdown.contains(e.target)){
    dropdown.classList.remove('active');
  }
});

// Search Input Listener - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• shared
(function(){
  const input = document.getElementById('product-search');
  if(!input) return;
  let t;
  input.addEventListener('input', (e) => {
    clearTimeout(t);
    t = setTimeout(() => {
        // Force switch to 'home' view but don't reset category immediately if logic requires
        // Actually, for global search we MUST be in 'all' category to scan everything visualy or override it in render
        if(currentCategory !== 'all') {
             // If user was in a specific category, switch to ALL to allow global search
             currentCategory = 'all';
             updateSectionTitle();
        }

        // Show Home View (Grid)
        const homeView = document.getElementById('view-home');
        const manageView = document.getElementById('view-manage');
        const stockView = document.getElementById('view-stock');
        const contactView = document.getElementById('view-contact');

        if(manageView) manageView.style.display = 'none';
        if(stockView) stockView.style.display = 'none';
        if(contactView) contactView.style.display = 'none';
        if(homeView) homeView.style.display = 'block';

        const searchQuery = e.target.value;
        // Don't re-fetch data here. Use the data already in memory (products variable) which is the source of truth.
        // Reloading from server might cause lag or overwrite local unsaved state if any.
        
        renderProducts(searchQuery);
    }, 160);
  });
})();

// --- FORM HANDLING ---

async function handleManageProduct(e){
  e.preventDefault();
  
  try {
      const form = e.target;
      const editIndexAttr = form.getAttribute('data-edit-index');
      const editIndex = (editIndexAttr !== null && editIndexAttr !== '') ? parseInt(editIndexAttr) : null;
      
      // Get image data
      let imageUrl = document.getElementById('product_image').value;
      const fileInput = document.getElementById('product_image_file');
      if(fileInput.files && fileInput.files[0]) {
        const preview = document.getElementById('imgPreview');
        const img = preview.querySelector('img');
        if(img && img.src) imageUrl = img.src;
      }
      
      const name = document.getElementById('product_name').value;
      const category = document.getElementById('product_category').value;
      const price = parseFloat(document.getElementById('product_price').value) || 0;
      const stock = parseInt(document.getElementById('product_stock').value) || 0;
      const desc = document.getElementById('product_desc').value;
      
      const productData = {
        name: name,
        category: category,
        price: price,
        originalPrice: price * 1.2,
        image: imageUrl || null,
        description: desc
      };
      
      let targetIndex = -1; // To track where we saved

      if(editIndex !== null && !isNaN(editIndex)){
        // Edit Mode
        targetIndex = editIndex;
        const existingProduct = products[editIndex] || {};
        if(existingProduct.id) productData.id = existingProduct.id;
        
        products[editIndex] = productData;
        
        if(stockData[editIndex]) {
            stockData[editIndex] = {
                ...stockData[editIndex],
                name: name,
                category: category,
                stock: stock,
                price: price,
                description: desc
            };
            if(existingProduct.id) stockData[editIndex].id = existingProduct.id;
        }
      } else {
        // Add Mode
        products.push(productData);
        targetIndex = products.length - 1;
        stockData.push({
          name: name,
          category: category,
          price: price,
          stock: stock,
          description: desc
        });
      }

      // 1. Save Local (Dual Save: LocalStorage + IndexedDB)
      try {
          // Try to save to big storage first (Unlimited)
          await saveToBigStorage('pranan_products_data', products);
          await saveToBigStorage('pranan_stock_data', stockData);
          
          // Still try to save to LocalStorage for backward compatibility (but might fail)
          localStorage.setItem('pranan_products_data', JSON.stringify(products));
          localStorage.setItem('pranan_stock_data', JSON.stringify(stockData));
      } catch (storageError) {
          console.warn('LocalStorage Full, but saved to BigStorage successfully.');
      }

      // 1.1 Save Shared (Cloud)
      if (typeof saveSharedProducts !== 'undefined') {
          saveSharedProducts(products, stockData);
      }
      
      // 2. Clear UI IMMEDIATELY
      form.reset();
      form.removeAttribute('data-edit-index');
      if(document.getElementById('product_image_file')) document.getElementById('product_image_file').value = '';
      updatePreview(''); // Reset Preview
      
      const submitBtn = form.querySelector('button[type="submit"]');
      if(submitBtn) {
          submitBtn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
          submitBtn.style.background = 'linear-gradient(135deg, #d50000 0%, #b40000 100%)';
      }

      // Force Preview Reset
      const previewEl = document.getElementById('imgPreview');
      if(previewEl) {
         previewEl.innerHTML = `
          <div style="text-align:center;">
             <div style="font-size:40px;margin-bottom:10px;">üñºÔ∏è</div>
             <div class="preview-hint">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà URL</div>
          </div>
         `;
      }
      
      // 3. Update Views
      renderProducts();
      renderStockTable();
      
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');

      // 4. Background Sync (API) - Fire and Forget
      (async function sync() {
          try {
              const apiMethod = (editIndex !== null && !isNaN(editIndex)) ? 'PUT' : 'POST';
              let apiUrl = '/products'; 
              
              if (apiMethod === 'PUT') {
                  const pId = products[editIndex]?.id; 
                  if(pId) apiUrl += `/${pId}`;
              }

              const response = await fetch(apiUrl, {
                  method: apiMethod,
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                      name, category, price, stock, description: desc, image: imageUrl || null
                  }),
              });
              
              const data = await response.json();
              if (apiMethod === 'POST' && data.id && targetIndex >= 0) {
                  if (products[targetIndex]) products[targetIndex].id = data.id;
                  if (stockData[targetIndex]) stockData[targetIndex].id = data.id;
                  localStorage.setItem('pranan_products_data', JSON.stringify(products));
                  localStorage.setItem('pranan_stock_data', JSON.stringify(stockData));
              }
          } catch(e) {
              // Ignore network errors in background
          }
      })();

      // 5. Cloud Sync
      if (typeof saveSharedProducts !== 'undefined') {
        saveSharedProducts(products, stockData).catch(e => console.error(e));
      }

  } catch(err) {
      console.error(err);
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
  }
}
  
  // Example Backend Logic (SQL/ORM) for Reference:
  /*
  // PHP with SQL
  $sql = "INSERT INTO products (name, category, price, stock, description, image) VALUES (?, ?, ?, ?, ?, ?)";
  $stmt = $conn->prepare($sql);
  $stmt->execute([$name, $category, $price, $stock, $description, $imageUrl]);

  // OR Node.js with Sequelize ORM
  await Product.create({
    name: name,
    category: category,
    price: price,
    stock: stock,
    description: description,
    image: imageUrl
  });
  */

// --- PRODUCT MANAGEMENT ---

// ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
function deleteProduct(index){
  if(confirm(`‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ "${products[index].name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)){
    products.splice(index, 1);
    stockData.splice(index, 1);
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á cloud
    if (typeof saveSharedProducts !== 'undefined') {
      saveSharedProducts(products, stockData);
    }
    
    // Save to Big Storage
    saveToBigStorage('pranan_products_data', products);
    saveToBigStorage('pranan_stock_data', stockData);

    renderProducts();
    renderStockTable();
    alert('‚úÖ ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
  }
}

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
function editProduct(index){
  const product = products[index];
  const stock = stockData[index];
  switchPage('manage');
  
  // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
  document.getElementById('product_name').value = product.name;
  document.getElementById('product_category').value = product.category;
  document.getElementById('product_price').value = stock.price || 0;
  document.getElementById('product_stock').value = stock.stock || 0;
  document.getElementById('product_image').value = product.image || '';
  document.getElementById('product_desc').value = product.description || '';
  
  // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó preview
  updatePreview(product.image || '');
  
  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó
  const form = document.getElementById('manageProductForm');
  form.setAttribute('data-edit-index', index);
  
  const submitBtn = form.querySelector('button[type="submit"]');
  submitBtn.textContent = 'üîÑ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
  submitBtn.style.background = 'linear-gradient(135deg, #FFA500, #FF8C00)';
}

// --- AUTH MODALS ---

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö login ‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
function buyProduct(name, price, image){
  const currentUser = localStorage.getItem('logged_in_user');
  if (!currentUser) {
    // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö -> ‡πÄ‡∏õ‡∏¥‡∏î Modal Login
    openLoginModal();
    return;
  }
  // ‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Buy Now) - ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÅ‡∏ï‡πà‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏•‡∏¢
  const item = [{ name, price, img: image, quantity: 1 }];
  checkout(item);
}

function openLoginModal(){ document.getElementById('loginModal').classList.add('show'); }
function closeLoginModal(){ document.getElementById('loginModal').classList.remove('show'); }

function openLogoutModal(){ document.getElementById('logoutModal').classList.add('show'); }
function closeLogoutModal(){ document.getElementById('logoutModal').classList.remove('show'); }

function openRegisterModal(){ document.getElementById('registerModal').classList.add('show'); }
function closeRegisterModal(){ document.getElementById('registerModal').classList.remove('show'); }

function openForgotPasswordModal(){ document.getElementById('forgotPasswordModal').classList.add('show'); }
function closeForgotPasswordModal(){ document.getElementById('forgotPasswordModal').classList.remove('show'); }

function openAdminModal(){ document.getElementById('adminModal').classList.add('show'); }
function closeAdminModal(){ 
  document.getElementById('adminModal').classList.remove('show'); 
  document.getElementById('admin_email').value = '';
  document.getElementById('admin_password').value = '';
}

function handleAdminLogin(event){
  event.preventDefault();
  const email = document.getElementById('admin_email').value;
  const password = document.getElementById('admin_password').value;
  const correctEmail = 'admin@pranan.com'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  const correctPassword = 'admin123'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  
  if(email === correctEmail && password === correctPassword){
    localStorage.setItem('logged_in_user', email);
    localStorage.setItem('is_admin', 'true');
    closeAdminModal();
    window.location.reload();
    // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å reload (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ localStorage ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥ state)
    localStorage.setItem('scroll_to_products', 'true');
  } else {
    alert('‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    document.getElementById('admin_password').value = '';
    document.getElementById('admin_email').focus();
  }
}

function openCartModal(){ document.getElementById('cartModal').classList.add('show'); }
function closeCartModal(){ document.getElementById('cartModal').classList.remove('show'); }

let directCheckoutItem = null;

function checkout(directItem = null){
  if (directItem) {
    directCheckoutItem = directItem; // Array of item(s)
  } else {
    directCheckoutItem = null;
    if(cart.length === 0){
        alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
        return;
    }
  }

  const itemsToProcess = directCheckoutItem ? directCheckoutItem : cart;
  const totalPrice = itemsToProcess.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  
  document.getElementById('checkoutTotal').textContent = formatPrice(totalPrice);
  
  // Close cart modal and open checkout modal
  closeCartModal();
  document.getElementById('checkoutModal').classList.add('show');
}

function closeCheckoutModal(){ 
  document.getElementById('checkoutModal').classList.remove('show'); 
}

function handleSlipPreview(input) {
    const preview = document.getElementById('slipPreviewImg');
    const label = document.getElementById('slipFileName');
    const icon = document.getElementById('slipIcon');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
            if(icon) icon.style.display = 'none';
            if(label) label.style.display = 'none'; // Hide text label when image shows
        }
        reader.readAsDataURL(input.files[0]);
    } else {
        preview.style.display = 'none';
        preview.src = '';
        if(icon) icon.style.display = 'block';
        if(label) {
            label.style.display = 'block';
            label.innerHTML = '‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ';
            label.style.color = '#666';
        }
    }
}

function submitOrder(event){
  event.preventDefault();
  const fullName = document.getElementById('fullName').value;
  const phone = document.getElementById('phone').value;
  // const email = document.getElementById('email').value; // Removed
  const address = document.getElementById('address').value;
  const paymentMethod = document.getElementById('paymentMethod').value;
  const paymentText = document.getElementById('paymentMethod').selectedOptions[0].text;
  
  // Check for Payment Slip if not COD
  if (paymentMethod !== 'cod') {
      const slipInput = document.getElementById('paymentSlip');
      if (!slipInput.files || slipInput.files.length === 0) {
          alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏•‡∏¥‡∏õ) ‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
          return;
      }
  }
  
  // Get total
  const itemsToProcess = directCheckoutItem ? directCheckoutItem : cart;
  const totalPrice = itemsToProcess.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  
  // Store pending order data (email removed)
  window.pendingOrderData = { fullName, phone, email: '-', address, paymentText, totalPrice };

  // Skip the old confirmation modals and go strictly to success
  processOrderSuccess();
}

function finishBankTransfer() {
  document.getElementById('bankTransferModal').classList.remove('show');
  processOrderSuccess();
}

function finishPromptPay() {
  document.getElementById('promptPayModal').classList.remove('show');
  processOrderSuccess();
}

function finishTrueMoney() {
  document.getElementById('trueMoneyModal').classList.remove('show');
  processOrderSuccess();
}

function processOrderSuccess() {
  const data = window.pendingOrderData;
  if(!data) return;

  // Create order summary
  const orderSummary = `
    <div style="text-align:center;">
      <img src="imgs/f1803c66-f331-4f54-8501-58d8a13c8524.jpg" alt="LINE QR Code" style="max-width:100%; width:200px; height:auto; border-radius:12px; margin-bottom:15px; box-shadow:0 4px 12px rgba(0,0,0,0.1);">
      <p style="font-size:15px; color:#333; margin-bottom:8px; line-height:1.5;">‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏≤‡∏á‡πÑ‡∏•‡∏ô‡πå</p>
      <p style="font-size:13px; color:#d50000; font-weight:bold; margin-top:0;">*‡∏´‡∏≤‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏õ‡∏•‡∏≠‡∏°‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡∏Ç‡∏≠‡πÑ‡∏°‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ*</p>
    </div>
  `;
  
  const summaryEl = document.getElementById('orderSummary');
  summaryEl.innerHTML = orderSummary;
  summaryEl.style.textAlign = 'center'; // Override container style
  summaryEl.style.background = 'transparent'; // Remove gray background if needed, or keep it. I'll make it transparent to look cleaner.
  summaryEl.style.border = 'none';
  
  // Clear cart and form (Only clear cart if NOT direct checkout)
  if (!directCheckoutItem) {
      cart = [];
      updateCartUI();
      syncCartToServer();
  }
  directCheckoutItem = null; // Reset direct checkout item

  document.getElementById('checkoutForm').reset();
  closeCheckoutModal();
  
  // Show success modal
  document.getElementById('successModal').classList.add('show');
  window.pendingOrderData = null;
}

function closeSuccessModal(){
  document.getElementById('successModal').classList.remove('show');
}

// Close modals on outside click
window.addEventListener('click', function(e){
  if(e.target.classList.contains('modal')){
      e.target.classList.remove('show');
  }
});

function handleLogin(e){
  e.preventDefault();
  const username = document.getElementById('username').value;
  if(username){
    localStorage.setItem('logged_in_user', username);
    window.location.reload();
  }
}

function handleLogout(){
  localStorage.removeItem('logged_in_user');
  localStorage.removeItem('is_admin'); // Clear Admin Flag
  window.location.reload();
}

function handleRegister(e){
  e.preventDefault();
  const email = document.getElementById('reg_email').value;
  // Simulate API Call
  setTimeout(() => {
     alert('‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
     localStorage.setItem('logged_in_user', email);
     window.location.reload();
  }, 1000);
}

function handleSocialRegister(provider) {
    // Simulate Social Login Process
    let fakeEmail = '';
    
    if (provider === 'google') {
        fakeEmail = 'user_google@gmail.com';
    } else if (provider === 'line') {
        fakeEmail = 'user_line@line.me';
    } else if (provider === 'facebook') {
        fakeEmail = 'user_facebook@fb.com';
    }
    
    // Simulate loading
    const btns = document.querySelectorAll('#register-social-view button');
    btns.forEach(b => b.style.opacity = '0.5');
    
    setTimeout(() => {
        alert(`‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ú‡πà‡∏≤‡∏ô ${provider.toUpperCase()} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        localStorage.setItem('logged_in_user', fakeEmail);
        window.location.reload();
    }, 1500);
}

function handleForgotPassword(e){
  e.preventDefault();
  const username = document.getElementById('forgot_username').value;
  const newPassword = document.getElementById('forgot_new_password').value;
  const confirmPassword = document.getElementById('forgot_confirm_password').value;
  
  if(newPassword !== confirmPassword) {
    alert(' ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    return;
  }
  
  if(newPassword.length < 6) {
    alert(' ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
    return;
  }
  
  alert(' ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ' + username);
  closeForgotPasswordModal();
  
  // Clear form
  document.getElementById('forgot_username').value = '';
  document.getElementById('forgot_new_password').value = '';
  document.getElementById('forgot_confirm_password').value = '';
}

// Handle Contact Form
function handleContactForm(e){
  e.preventDefault();
  const name = document.getElementById('contact_name').value;
  const email = document.getElementById('contact_email').value;
  const phone = document.getElementById('contact_phone').value;
  const message = document.getElementById('contact_message').value;
  
  // Simulate sending message
  alert(`‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\n‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì ${name} ‡πÅ‡∏•‡πâ‡∏ß\n‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`);
  
  // Clear form
  document.getElementById('contact_name').value = '';
  document.getElementById('contact_email').value = '';
  document.getElementById('contact_phone').value = '';
  document.getElementById('contact_message').value = '';
}

// Check Login State
function updateLoginButton(){
  const user = localStorage.getItem('logged_in_user');
  const btn = document.querySelector('.login-btn');
  const adminBtn = document.getElementById('adminBtn');
  
  if(user && btn){
    btn.textContent = 'üë§ ' + user;
    btn.onclick = openLogoutModal;
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° Admin ‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡πÅ‡∏•‡πâ‡∏ß
    if(adminBtn){
      adminBtn.style.display = 'none';
    }
  } else {
    // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Admin ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login
    if(adminBtn){
      adminBtn.style.display = 'inline-block';
    }
  }
}

// --- CAROUSEL FUNCTIONS ---
let currentSlide = 0;
const totalSlides = 5;
let autoSlideInterval;

function moveCarousel(direction) {
    currentSlide += direction;
    if(currentSlide < 0) currentSlide = totalSlides - 1;
    if(currentSlide >= totalSlides) currentSlide = 0;
    updateCarousel();
    resetAutoSlide();
}

function goToSlide(index) {
    currentSlide = index;
    updateCarousel();
    resetAutoSlide();
}

function updateCarousel() {
    const wrapper = document.getElementById('carouselWrapper');
    const indicators = document.querySelectorAll('.carousel-indicator');
    
    if(wrapper) {
        wrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
    }
    
    indicators.forEach((indicator, index) => {
        if(index === currentSlide) {
            indicator.classList.add('active');
        } else {
            indicator.classList.remove('active');
        }
    });
}

function startAutoSlide() {
    autoSlideInterval = setInterval(() => {
        moveCarousel(1);
    }, 4000); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
}

function resetAutoSlide() {
    clearInterval(autoSlideInterval);
    startAutoSlide();
}

// --- SNOWFLAKE GENERATOR - DISABLED ---
/*
function createSnowflake() {
    const snowflake = document.createElement('div');
    snowflake.classList.add('snowflake');
    snowflake.innerHTML = '‚ùÖ';
    snowflake.style.left = Math.random() * 100 + '%';
    snowflake.style.animationDuration = Math.random() * 3 + 5 + 's';
    snowflake.style.opacity = Math.random();
    snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
    document.body.appendChild(snowflake);
    setTimeout(() => {
        snowflake.remove();
    }, 8000);
}

setInterval(createSnowflake, 200);
*/

// --- DATABASE HELPER (IndexedDB High Capacity Storage) ---
const dbName = 'PrananShopDB';
const storeName = 'shopData';

function initDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(dbName, 1);
        request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains(storeName)) {
                db.createObjectStore(storeName, { keyPath: 'id' });
            }
        };
        request.onsuccess = (event) => resolve(event.target.result);
        request.onerror = (event) => reject(event.target.error);
    });
}

async function saveToBigStorage(key, data) {
    try {
        const db = await initDB();
        return new Promise((resolve, reject) => {
            const tx = db.transaction(storeName, 'readwrite');
            const store = tx.objectStore(storeName);
            const request = store.put({ id: key, data: data });
            tx.oncomplete = () => resolve(true);
            tx.onerror = () => reject(tx.error);
        });
    } catch (err) {
        console.error('BigStorage Save Error:', err);
        return false;
    }
}

async function loadFromBigStorage(key) {
    try {
        const db = await initDB();
        return new Promise((resolve, reject) => {
            const tx = db.transaction(storeName, 'readonly');
            const store = tx.objectStore(storeName);
            const request = store.get(key);
            request.onsuccess = () => resolve(request.result ? request.result.data : null);
            request.onerror = () => resolve(null);
        });
    } catch (err) {
        console.error('BigStorage Load Error:', err);
        return null;
    }
}

// --- INIT ---
// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å shared storage ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
(async function initApp() {
  
  // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å Server ‡∏ñ‡πâ‡∏≤ login ‡∏≠‡∏¢‡∏π‡πà
  await loadCartFromServer();

  // --- START: API GET INTEGRATION ---
  try {
    console.log('üîÑ Fetching products from API...');
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    const response = await fetch('/products', { 
        method: 'GET' 
    });
    
    if (response.ok) {
        const apiData = await response.json();
        console.log('API Success (GET):', apiData);
        if (apiData.data && Array.isArray(apiData.data)) {
           // Map Server Data to Frontend Structure
           products = apiData.data.map(item => ({
             id: item.id,
             name: item.name,
             category: item.category,
             price: item.price,
             originalPrice: item.price * 1.2,
             image: item.image,
             description: item.description
           }));

           stockData = apiData.data.map(item => ({
             id: item.id,
             name: item.name,
             category: item.category,
             price: item.price,
             stock: item.stock,
             description: item.description
           }));
           
           // Update LocalStorage
           localStorage.setItem('pranan_products_data', JSON.stringify(products));
           localStorage.setItem('pranan_stock_data', JSON.stringify(stockData));
           console.log('‚úÖ Loaded ' + products.length + ' products from Server');
        }
    } else {
        console.warn('‚ö†Ô∏è API Response not OK:', response.status);
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è API Fetch Failed (Using local/shared data instead):', error);
  }
  // --- END: API GET INTEGRATION ---

  try {
    if (typeof loadSharedProducts !== 'undefined') {
      console.log('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å cloud...');
      
      // 1. Try BigStorage first (IndexedDB)
      const cachedProducts = await loadFromBigStorage('pranan_products_data');
      const cachedStock = await loadFromBigStorage('pranan_stock_data');
      
      if (cachedProducts && cachedProducts.length > 0) {
          products = cachedProducts;
          if(cachedStock) stockData = cachedStock;
          console.log('‚úÖ Loaded from BigStorage (IndexedDB)');
      } else {
           // 2. Fallback to LocalStorage
           const hasLocalData = localStorage.getItem('pranan_products_data');
           if (!hasLocalData) {
               const { products: sharedProducts, stockData: sharedStock } = await loadSharedProducts();
               if (sharedProducts && sharedProducts.length > 0) {
                 products = sharedProducts;
                 stockData = sharedStock;
               }
           } else {
               console.log('‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage (‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)');
           }
      }
    }
  } catch (error) {
    console.warn(' ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:', error.message);
  } finally {
    renderProducts();
  }
})();
updateLoginButton();
startAutoSlide();

// Add Event Listener for Payment Method Change
const paymentMethodEl = document.getElementById('paymentMethod');
if (paymentMethodEl) {
    paymentMethodEl.addEventListener('change', function(e) {
        const method = e.target.value;
        const detailsDiv = document.getElementById('paymentDetails');
        const slipSection = document.getElementById('slipUploadSection');
        const sections = ['payment-truemoney', 'payment-promptpay', 'payment-transfer'];
        
        // Hide all first
        sections.forEach(id => {
            const el = document.getElementById(id);
            if(el) el.style.display = 'none';
        });

        if(method === 'truemoney' || method === 'promptpay' || method === 'transfer') {
             if(detailsDiv) detailsDiv.style.display = 'block';
             if(slipSection) slipSection.style.display = 'block';
            if(method === 'truemoney') { const el = document.getElementById('payment-truemoney'); if(el) el.style.display = 'block'; }
            if(method === 'promptpay') { const el = document.getElementById('payment-promptpay'); if(el) el.style.display = 'block'; }
            if(method === 'transfer') { const el = document.getElementById('payment-transfer'); if(el) el.style.display = 'block'; }
        } else {
             if(detailsDiv) detailsDiv.style.display = 'none';
             if(slipSection) slipSection.style.display = 'none';
        }
    });

    // Initial check (in case browser restores state)
    if(paymentMethodEl.value) {
        paymentMethodEl.dispatchEvent(new Event('change'));
    }
}

</script>

<!-- FLOATING CONTACT BUTTON -->
<div class="floating-contact" onclick="switchPage('contact'); return false;">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</div>

</body>
</html>